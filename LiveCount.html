<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TUNŒûS Music</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
    --bg:#0a0a0a;
    --panel:#1a1a1a;
    --sidebar-bg:#252525;
    --soft:#2a2a2a;
    --hover:#333333;
    --accent:#1db954;
    --accent-dim:#1ed760;
    --text:#ffffff;
    --muted:#b3b3b3;
    --glow:rgba(29,185,84,.3);
    --gradient-color:#1db954;
    --border:rgba(255,255,255,.08);
}

*{
    box-sizing:border-box;
    margin:0;
    padding:0;
}

body{
    font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;
    background:var(--bg);
    color:var(--text);
    overflow:hidden;
    height:100vh;
}

.app-container{
    display:flex;
    height:100vh;
    gap:12px;
    padding:12px;
}

/* LEFT SIDEBAR */
.left-sidebar{
    width:280px;
    display:flex;
    flex-direction:column;
    gap:12px;
    transition:width .3s;
}

.left-sidebar.minimized{
    width:80px;
}

.sidebar-top{
    background:var(--sidebar-bg);
    border-radius:12px;
    padding:20px;
    display:flex;
    flex-direction:column;
    gap:16px;
}

.logo{
    font-size:24px;
    font-weight:900;
    color:var(--text);
    letter-spacing:-1px;
    text-align:center;
}

.nav-buttons{
    display:flex;
    flex-direction:column;
    gap:8px;
}

.nav-btn{
    padding:12px 16px;
    background:transparent;
    border:none;
    color:var(--muted);
    border-radius:8px;
    cursor:pointer;
    transition:all .2s;
    display:flex;
    align-items:center;
    gap:12px;
    font-size:15px;
    font-weight:600;
}

.nav-btn:hover{
    background:var(--hover);
    color:var(--text);
}

.nav-btn.active{
    background:var(--soft);
    color:var(--text);
}

.sidebar-library{
    background:var(--sidebar-bg);
    border-radius:12px;
    padding:20px;
    flex:1;
    overflow-y:auto;
    display:flex;
    flex-direction:column;
    gap:12px;
}

.library-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    margin-bottom:8px;
}

.library-header h3{
    font-size:14px;
    color:var(--muted);
    text-transform:uppercase;
    letter-spacing:1px;
}

.create-playlist-btn{
    background:var(--accent);
    border:none;
    color:#000;
    width:32px;
    height:32px;
    border-radius:50%;
    font-size:20px;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    transition:all .2s;
}

.create-playlist-btn:hover{
    background:var(--accent-dim);
    transform:scale(1.05);
}

.playlist-item{
    padding:12px;
    background:var(--soft);
    border-radius:8px;
    cursor:pointer;
    transition:all .2s;
    display:flex;
    align-items:center;
    gap:12px;
}

.playlist-item:hover{
    background:var(--hover);
}

.playlist-item.active{
    background:var(--accent);
    color:#000;
}

.playlist-icon{
    font-size:24px;
}

.playlist-info{
    flex:1;
    min-width:0;
}

.playlist-name{
    font-size:14px;
    font-weight:600;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
}

.playlist-count{
    font-size:12px;
    color:var(--muted);
}

.playlist-item.active .playlist-count{
    color:#000;
    opacity:0.7;
}

/* MAIN CONTENT */
.main-content{
    flex:1;
    background:linear-gradient(180deg, var(--gradient-color) 0%, var(--bg) 20%);
    border-radius:12px;
    overflow-y:auto;
    padding:32px;
    transition:background .8s;
}

.section{
    margin-bottom:40px;
}

.section-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    margin-bottom:20px;
}

.section-header h2{
    font-size:24px;
    font-weight:700;
}

.scroll-btns{
    display:flex;
    gap:8px;
}

.scroll-btn{
    width:36px;
    height:36px;
    background:rgba(0,0,0,.5);
    border:none;
    border-radius:50%;
    color:var(--text);
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    transition:all .2s;
}

.scroll-btn:hover{
    background:rgba(0,0,0,.7);
}

/* Recently Played Grid */
.recent-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));
    gap:16px;
}

.song-card{
    background:rgba(0,0,0,.3);
    border-radius:8px;
    padding:16px;
    cursor:pointer;
    transition:all .3s;
    display:flex;
    align-items:center;
    gap:12px;
}

.song-card:hover{
    background:rgba(0,0,0,.5);
    transform:translateY(-2px);
}

.song-card img{
    width:56px;
    height:56px;
    border-radius:6px;
    object-fit:cover;
    flex-shrink:0;
}

.song-info{
    flex:1;
    min-width:0;
}

.song-title{
    font-size:14px;
    font-weight:600;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    margin-bottom:4px;
}

.song-artist{
    font-size:12px;
    color:var(--muted);
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
}

/* Horizontal Scroll Sections */
.scroll-container{
    display:flex;
    gap:16px;
    overflow-x:auto;
    padding-bottom:8px;
    scroll-behavior:smooth;
}

.scroll-container::-webkit-scrollbar{
    height:8px;
}

.scroll-container::-webkit-scrollbar-track{
    background:rgba(255,255,255,.05);
    border-radius:4px;
}

.scroll-container::-webkit-scrollbar-thumb{
    background:rgba(255,255,255,.2);
    border-radius:4px;
}

.album-card{
    min-width:180px;
    background:rgba(0,0,0,.3);
    border-radius:8px;
    padding:16px;
    cursor:pointer;
    transition:all .3s;
}

.album-card:hover{
    background:rgba(0,0,0,.5);
    transform:translateY(-4px);
}

.album-card img{
    width:100%;
    aspect-ratio:1;
    border-radius:6px;
    margin-bottom:12px;
}

.album-title{
    font-size:14px;
    font-weight:600;
    margin-bottom:4px;
    overflow:hidden;
    text-overflow:ellipsis;
    display:-webkit-box;
    -webkit-line-clamp:2;
    -webkit-box-orient:vertical;
}

.album-artist{
    font-size:12px;
    color:var(--muted);
}

/* RIGHT SIDEBAR */
.right-sidebar{
    width:380px;
    background:var(--sidebar-bg);
    border-radius:12px;
    overflow:hidden;
    display:flex;
    flex-direction:column;
    transition:width .3s;
}

.right-sidebar.minimized{
    width:0;
    padding:0;
}

.video-container{
    position:relative;
    width:100%;
    aspect-ratio:16/9;
    background:#000;
}

.video-container iframe{
    width:100%;
    height:100%;
    border:none;
}

.now-playing-info{
    padding:20px;
}

.np-title{
    font-size:18px;
    font-weight:700;
    margin-bottom:4px;
}

.np-artist{
    font-size:14px;
    color:var(--muted);
    margin-bottom:16px;
}

.playback-controls{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:16px;
    padding:16px 0;
}

.control-btn{
    width:40px;
    height:40px;
    background:transparent;
    border:none;
    color:var(--text);
    cursor:pointer;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    transition:all .2s;
    font-size:20px;
}

.control-btn:hover{
    background:var(--hover);
}

.control-btn.play{
    background:var(--accent);
    color:#000;
    width:48px;
    height:48px;
    font-size:24px;
}

.control-btn.play:hover{
    background:var(--accent-dim);
    transform:scale(1.05);
}

.lyrics-section{
    flex:1;
    padding:20px;
    overflow-y:auto;
}

.lyrics-section h4{
    font-size:16px;
    font-weight:600;
    margin-bottom:16px;
    color:var(--accent);
}

.lyrics{
    font-size:14px;
    line-height:1.8;
    color:var(--muted);
    white-space:pre-wrap;
}

.lyrics.loading{
    text-align:center;
    font-style:italic;
}

/* Search View */
.search-view{
    display:none;
}

.search-view.active{
    display:block;
}

.search-header{
    margin-bottom:32px;
}

.search-input{
    width:100%;
    max-width:600px;
    padding:16px 24px;
    background:rgba(0,0,0,.3);
    border:2px solid rgba(255,255,255,.1);
    border-radius:30px;
    color:var(--text);
    font-size:16px;
    transition:all .2s;
}

.search-input:focus{
    outline:none;
    border-color:var(--accent);
    background:rgba(0,0,0,.5);
}

.search-results{
    display:flex;
    flex-direction:column;
    gap:32px;
}

/* Toast Notification */
.toast{
    position:fixed;
    bottom:24px;
    left:50%;
    transform:translateX(-50%);
    background:rgba(0,0,0,.95);
    backdrop-filter:blur(10px);
    color:var(--text);
    padding:16px 24px;
    border-radius:8px;
    display:flex;
    align-items:center;
    gap:12px;
    box-shadow:0 8px 32px rgba(0,0,0,.5);
    opacity:0;
    transition:opacity .3s;
    z-index:1000;
    pointer-events:none;
}

.toast.show{
    opacity:1;
}

.toast img{
    width:48px;
    height:48px;
    border-radius:4px;
}

.toast-info{
    flex:1;
    min-width:0;
}

.toast-title{
    font-size:14px;
    font-weight:600;
    margin-bottom:2px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
}

.toast-subtitle{
    font-size:12px;
    color:var(--muted);
}

/* Modal */
.modal{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.8);
    backdrop-filter:blur(10px);
    z-index:1000;
    align-items:center;
    justify-content:center;
}

.modal.active{
    display:flex;
}

.modal-content{
    background:var(--panel);
    padding:32px;
    border-radius:16px;
    max-width:400px;
    width:90%;
    border:1px solid var(--border);
}

.modal-content h3{
    margin-bottom:24px;
    font-size:24px;
}

.modal-content input{
    width:100%;
    padding:14px;
    border-radius:8px;
    border:1px solid var(--border);
    background:var(--soft);
    color:var(--text);
    font-size:14px;
    margin-bottom:16px;
}

.modal-content input:focus{
    outline:none;
    border-color:var(--accent);
}

.modal-buttons{
    display:flex;
    gap:12px;
}

.modal-buttons button{
    flex:1;
    padding:14px;
    border:none;
    border-radius:8px;
    font-size:14px;
    font-weight:600;
    cursor:pointer;
    transition:all .2s;
}

.modal-buttons .primary{
    background:var(--accent);
    color:#000;
}

.modal-buttons .secondary{
    background:var(--soft);
    color:var(--text);
}

.modal-buttons button:hover{
    transform:scale(1.02);
}

/* Scrollbar */
::-webkit-scrollbar{
    width:10px;
}

::-webkit-scrollbar-track{
    background:rgba(255,255,255,.02);
}

.scrollbar-thumb{
    background:rgba(255,255,255,.12);
    border-radius:10px;
}

::-webkit-scrollbar-thumb:hover{
    background:rgba(255,255,255,.2);
}

/* Toggle Buttons */
.toggle-sidebar{
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    width:24px;
    height:48px;
    background:var(--sidebar-bg);
    border:none;
    color:var(--muted);
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    transition:all .2s;
    z-index:10;
}

.toggle-sidebar:hover{
    color:var(--text);
    background:var(--soft);
}

.toggle-left{
    right:-24px;
    border-radius:0 8px 8px 0;
}

.toggle-right{
    left:-24px;
    border-radius:8px 0 0 8px;
}

.minimized .toggle-left{
    right:0;
}

.minimized .toggle-right{
    left:0;
}
</style>
</head>
<body>

<div class="app-container">
    <!-- LEFT SIDEBAR -->
    <aside class="left-sidebar" id="leftSidebar">
        <div class="sidebar-top">
            <div class="logo">TUN<span style="font-style:italic">Œû</span>S</div>
            <div class="nav-buttons">
                <button class="nav-btn active" id="homeBtn" onclick="showHome()">
                    <span>üè†</span> Home
                </button>
                <button class="nav-btn" id="searchBtn" onclick="showSearch()">
                    <span>üîç</span> Search
                </button>
            </div>
        </div>
        
        <div class="sidebar-library">
            <div class="library-header">
                <h3>Your Library</h3>
                <button class="create-playlist-btn" onclick="openCreateModal()">+</button>
            </div>
            
            <div class="playlist-item" onclick="viewLikedSongs()">
                <span class="playlist-icon">üíö</span>
                <div class="playlist-info">
                    <div class="playlist-name">Liked Songs</div>
                    <div class="playlist-count" id="likedCount">0 songs</div>
                </div>
            </div>
            
            <div id="playlistsList"></div>
        </div>
        
        <button class="toggle-sidebar toggle-left" onclick="toggleLeftSidebar()">‚Ä∫</button>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content" id="mainContent">
        <!-- HOME VIEW -->
        <div id="homeView">
            <div class="section">
                <div class="section-header">
                    <h2>Recently Played</h2>
                </div>
                <div class="recent-grid" id="recentGrid"></div>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2>Recent Albums</h2>
                </div>
                <div class="scroll-container" id="albumsScroll"></div>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2>Recommended Mixes</h2>
                </div>
                <div class="scroll-container" id="mixesScroll"></div>
            </div>
        </div>

        <!-- SEARCH VIEW -->
        <div class="search-view" id="searchView">
            <div class="search-header">
                <input type="text" class="search-input" id="searchInput" placeholder="What do you want to listen to?">
            </div>
            <div class="search-results" id="searchResults"></div>
        </div>
    </main>

    <!-- RIGHT SIDEBAR -->
    <aside class="right-sidebar" id="rightSidebar">
        <div class="video-container">
            <iframe id="player" allow="autoplay; encrypted-media"></iframe>
        </div>
        
        <div class="now-playing-info">
            <div class="np-title" id="npTitle">Select a song to play</div>
            <div class="np-artist" id="npArtist"></div>
            
            <div class="playback-controls">
                <button class="control-btn" onclick="skipToPrevious()">‚èÆ</button>
                <button class="control-btn play" onclick="togglePlay()">‚ñ∂</button>
                <button class="control-btn" onclick="skipToNext()">‚è≠</button>
            </div>
        </div>
        
        <div class="lyrics-section">
            <h4>Lyrics</h4>
            <div class="lyrics loading" id="lyrics">Play a song to view lyrics...</div>
        </div>
        
        <button class="toggle-sidebar toggle-right" onclick="toggleRightSidebar()">‚Äπ</button>
    </aside>
</div>

<!-- Toast Notification -->
<div class="toast" id="toast">
    <img id="toastImg" src="" alt="">
    <div class="toast-info">
        <div class="toast-title" id="toastTitle"></div>
        <div class="toast-subtitle" id="toastSubtitle">Now Playing</div>
    </div>
</div>

<!-- Create Playlist Modal -->
<div class="modal" id="createModal">
    <div class="modal-content">
        <h3>Create Playlist</h3>
        <input type="text" id="playlistNameInput" placeholder="Playlist name">
        <input type="text" id="playlistEmojiInput" placeholder="Emoji (e.g. üéµ)" maxlength="2">
        <div class="modal-buttons">
            <button class="secondary" onclick="closeCreateModal()">Cancel</button>
            <button class="primary" onclick="createPlaylist()">Create</button>
        </div>
    </div>
</div>

<script>
const YT_KEY = "AIzaSyDNd7dwB1rZEpJzpyRrVZQwSKHvnt3Q7vQ";

// Storage
function save(key, data) {
    try {
        localStorage.setItem(key, JSON.stringify(data));
    } catch (e) {
        console.error("Storage error:", e);
    }
}

function load(key, def) {
    try {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : def;
    } catch (e) {
        return def;
    }
}

// State
let recent = load("recent", []);
let playlists = load("playlists", {});
let liked = load("liked", []);
let currentPlaylist = null;
let currentSongs = [];
let currentIndex = -1;
let ytPlayer = null;

// Initialize
renderRecent();
renderPlaylists();
renderAlbums();
renderMixes();
updateLikedCount();

// Load YouTube API
const tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
document.getElementsByTagName('script')[0].parentNode.insertBefore(tag, document.getElementsByTagName('script')[0]);

function onYouTubeIframeAPIReady() {
    ytPlayer = new YT.Player('player', {
        events: {
            'onStateChange': onPlayerStateChange
        }
    });
}

function onPlayerStateChange(event) {
    if (event.data === YT.PlayerState.ENDED) {
        skipToNext();
    }
}

// Navigation
function showHome() {
    document.getElementById('homeView').style.display = 'block';
    document.getElementById('searchView').classList.remove('active');
    document.getElementById('homeBtn').classList.add('active');
    document.getElementById('searchBtn').classList.remove('active');
}

function showSearch() {
    document.getElementById('homeView').style.display = 'none';
    document.getElementById('searchView').classList.add('active');
    document.getElementById('homeBtn').classList.remove('active');
    document.getElementById('searchBtn').classList.add('active');
    document.getElementById('searchInput').focus();
}

function toggleLeftSidebar() {
    document.getElementById('leftSidebar').classList.toggle('minimized');
}

function toggleRightSidebar() {
    document.getElementById('rightSidebar').classList.toggle('minimized');
}

// Search
let searchTimeout;
document.getElementById('searchInput').oninput = async (e) => {
    clearTimeout(searchTimeout);
    const q = e.target.value.trim();
    
    if (!q) {
        document.getElementById('searchResults').innerHTML = '';
        return;
    }
    
    searchTimeout = setTimeout(async () => {
        try {
            // Search for both videos and playlists
            const [videos, playlists] = await Promise.all([
                fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&videoCategoryId=10&maxResults=10&q=${encodeURIComponent(q)}&key=${YT_KEY}`).then(r => r.json()),
                fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=playlist&maxResults=4&q=${encodeURIComponent(q + ' album')}&key=${YT_KEY}`).then(r => r.json())
            ]);
            
            renderSearchResults(videos, playlists);
        } catch (error) {
            console.error("Search error:", error);
        }
    }, 300);
};

function renderSearchResults(videos, playlists) {
    const container = document.getElementById('searchResults');
    container.innerHTML = '';
    
    // Albums section
    if (playlists.items && playlists.items.length > 0) {
        const albumSection = document.createElement('div');
        albumSection.className = 'section';
        albumSection.innerHTML = `
            <div class="section-header"><h2>Albums</h2></div>
            <div class="scroll-container"></div>
        `;
        
        const scrollContainer = albumSection.querySelector('.scroll-container');
        playlists.items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'album-card';
            div.innerHTML = `
                <img src="${item.snippet.thumbnails.medium.url}">
                <div class="album-title">${escapeHtml(item.snippet.title)}</div>
                <div class="album-artist">${escapeHtml(item.snippet.channelTitle)}</div>
            `;
            div.onclick = () => playPlaylist(item.id.playlistId);
            scrollContainer.appendChild(div);
        });
        
        container.appendChild(albumSection);
    }
    
    // Songs section
    if (videos.items && videos.items.length > 0) {
        const songSection = document.createElement('div');
        songSection.className = 'section';
        songSection.innerHTML = `
            <div class="section-header"><h2>Songs</h2></div>
            <div class="recent-grid"></div>
        `;
        
        const grid = songSection.querySelector('.recent-grid');
        videos.items.forEach(item => {
            const song = {
                id: item.id.videoId,
                title: item.snippet.title,
                artist: item.snippet.channelTitle,
                art: item.snippet.thumbnails.medium.url
            };
            
            const div = document.createElement('div');
            div.className = 'song-card';
            div.innerHTML = `
                <img src="${song.art}">
                <div class="song-info">
                    <div class="song-title">${escapeHtml(song.title)}</div>
                    <div class="song-artist">${escapeHtml(song.artist)}</div>
                </div>
            `;
            div.onclick = () => playSong(song);
            grid.appendChild(div);
        });
        
        container.appendChild(songSection);
    }
}

async function playPlaylist(playlistId) {
    try {
        const response = await fetch(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${playlistId}&key=${YT_KEY}`);
        const data = await response.json();
        
        if (data.items && data.items.length > 0) {
            currentSongs = data.items.map(item => ({
                id: item.snippet.resourceId.videoId,
                title: item.snippet.title,
                artist: item.snippet.channelTitle,
                art: item.snippet.thumbnails.medium.url
            }));
            currentIndex = 0;
            playSong(currentSongs[0]);
        }
    } catch (error) {
        console.error("Playlist error:", error);
    }
}

// Playback
function playSong(song) {
    document.getElementById('player').src = `https://www.youtube.com/embed/${song.id}?autoplay=1&enablejsapi=1&rel=0`;
    document.getElementById('npTitle').textContent = song.title;
    document.getElementById('npArtist').textContent = song.artist;
    
    addToRecent(song);
    updateGradient(song.art);
    fetchLyrics(song.title, song.artist);
    showToast(song);
    
    // Update index if song is in current playlist
    const idx = currentSongs.findIndex(s => s.id === song.id);
    if (idx !== -1) currentIndex = idx;
}

function skipToNext() {
    if (currentIndex < currentSongs.length - 1) {
        currentIndex++;
        playSong(currentSongs[currentIndex]);
    }
}

function skipToPrevious() {
    if (currentIndex > 0) {
        currentIndex--;
        playSong(currentSongs[currentIndex]);
    }
}

function togglePlay() {
    // Will be implemented with YouTube API
}

// Toast notification
function showToast(song) {
    const toast = document.getElementById('toast');
    document.getElementById('toastImg').src = song.art;
    document.getElementById('toastTitle').textContent = song.title;
    toast.classList.add('show');
    
    setTimeout(() => {
        toast.classList.remove('show');
    }, 5000);
}

// Recent songs
function addToRecent(song) {
    recent = recent.filter(s => s.id !== song.id);
    recent.unshift(song);
    recent = recent.slice(0, 8);
    save("recent", recent);
    renderRecent();
}

function renderRecent() {
    const grid = document.getElementById('recentGrid');
    grid.innerHTML = '';
    
    recent.forEach(song => {
        const div = document.createElement('div');
        div.className = 'song-card';
        div.innerHTML = `
            <img src="${song.art}">
            <div class="song-info">
                <div class="song-title">${escapeHtml(song.title)}</div>
                <div class="song-artist">${escapeHtml(song.artist)}</div>
            </div>
        `;
        div.onclick = () => playSong(song);
        grid.appendChild(div);
    });
}

// Albums (from recent)
function renderAlbums() {
    const container = document.getElementById('albumsScroll');
    const albums = recent.slice(0, 6);
    
    albums.forEach(song => {
        const div = document.createElement('div');
        div.className = 'album-card';
        div.innerHTML = `
            <img src="${song.art}">
            <div class="album-title">${esc// Albums (from recent)
function renderAlbums() {
    const container = document.getElementById('albumsScroll');
    container.innerHTML = '';
    const albums = recent.slice(0, 6);
    
    albums.forEach(song => {
        const div = document.createElement('div');
        div.className = 'album-card';
        div.innerHTML = `
            <img src="${song.art}">
            <div class="album-title">${escapeHtml(song.title)}</div>
            <div class="album-artist">${escapeHtml(song.artist)}</div>
        `;
        div.onclick = () => playSong(song);
        container.appendChild(div);
    });
}

// Mixes (recommended - using recent songs)
function renderMixes() {
    const container = document.getElementById('mixesScroll');
    container.innerHTML = '';
    const mixes = recent.slice(0, 6);
    
    mixes.forEach(song => {
        const div = document.createElement('div');
        div.className = 'album-card';
        div.innerHTML = `
            <img src="${song.art}">
            <div class="album-title">${escapeHtml(song.title)} Mix</div>
            <div class="album-artist">AI Generated</div>
        `;
        div.onclick = () => playSong(song);
        container.appendChild(div);
    });
}

// Playlists
function renderPlaylists() {
    const container = document.getElementById('playlistsList');
    container.innerHTML = '';
    
    Object.keys(playlists).forEach(name => {
        const playlist = playlists[name];
        const div = document.createElement('div');
        div.className = 'playlist-item';
        div.innerHTML = `
            <span class="playlist-icon">${playlist.emoji || 'üéµ'}</span>
            <div class="playlist-info">
                <div class="playlist-name">${escapeHtml(name)}</div>
                <div class="playlist-count">${playlist.songs.length} songs</div>
            </div>
        `;
        div.onclick = () => viewPlaylist(name);
        container.appendChild(div);
    });
}

function viewPlaylist(name) {
    currentPlaylist = name;
    currentSongs = playlists[name].songs;
    currentIndex = 0;
    if (currentSongs.length > 0) {
        playSong(currentSongs[0]);
    }
}

function viewLikedSongs() {
    currentSongs = liked;
    currentIndex = 0;
    if (currentSongs.length > 0) {
        playSong(currentSongs[0]);
    }
}

function updateLikedCount() {
    document.getElementById('likedCount').textContent = `${liked.length} songs`;
}

// Gradient color extraction
function updateGradient(imageUrl) {
    const img = new Image();
    img.crossOrigin = "Anonymous";
    img.src = imageUrl;
    
    img.onload = () => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 1;
        canvas.height = 1;
        ctx.drawImage(img, 0, 0, 1, 1);
        const data = ctx.getImageData(0, 0, 1, 1).data;
        const color = `rgb(${data[0]}, ${data[1]}, ${data[2]})`;
        document.documentElement.style.setProperty('--gradient-color', color);
    };
}

// Lyrics
async function fetchLyrics(title, artist) {
    const lyricsDiv = document.getElementById('lyrics');
    lyricsDiv.className = 'lyrics loading';
    lyricsDiv.textContent = 'Loading lyrics...';
    
    try {
        const cleanTitle = title.split('(')[0].split('[')[0].split('|')[0].trim();
        const cleanArtist = artist.split('-')[0].split('(')[0].trim();
        
        const response = await fetch(`https://api.lyrics.ovh/v1/${encodeURIComponent(cleanArtist)}/${encodeURIComponent(cleanTitle)}`);
        const data = await response.json();
        
        if (data.lyrics) {
            lyricsDiv.className = 'lyrics';
            lyricsDiv.textContent = data.lyrics;
        } else {
            lyricsDiv.className = 'lyrics loading';
            lyricsDiv.textContent = 'Lyrics not available';
        }
    } catch (error) {
        lyricsDiv.className = 'lyrics loading';
        lyricsDiv.textContent = 'Could not load lyrics';
    }
}

// Modal functions
function openCreateModal() {
    document.getElementById('createModal').classList.add('active');
    document.getElementById('playlistNameInput').focus();
}

function closeCreateModal() {
    document.getElementById('createModal').classList.remove('active');
    document.getElementById('playlistNameInput').value = '';
    document.getElementById('playlistEmojiInput').value = '';
}

function createPlaylist() {
    const name = document.getElementById('playlistNameInput').value.trim();
    const emoji = document.getElementById('playlistEmojiInput').value.trim() || 'üéµ';
    
    if (!name) return;
    
    if (playlists[name]) {
        alert('Playlist already exists!');
        return;
    }
    
    playlists[name] = { emoji, songs: [] };
    save('playlists', playlists);
    renderPlaylists();
    closeCreateModal();
}

// Utilities
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}
</script>
</body>
</html>
