<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>jvst Music</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">


<style>
:root{
    --bg:#121212;
    --panel:#1e1e1e;
    --soft:#282828;
    --hover:#333333;
    --accent:#1db954;
    --accent-dim:#1ed760;
    --text:#ffffff;
    --muted:#b3b3b3;
    --glow:rgba(29,185,84,.3);
}

*{
    box-sizing:border-box;
    margin:0;
    padding:0;
}

body{
    font-family:'Circular Std','Segoe UI',system-ui,sans-serif;
    background:var(--bg);
    color:var(--text);
    overflow:hidden;
}

/* ───────── ANIMATED BACKGROUND ───────── */
.bg-gradient{
    position:fixed;
    inset:0;
background: linear-gradient(#001414, #000000);

    z-index:0;
}

/* ───────── TOP BAR ───────── */
.topbar{
    position:sticky;
    top:0;
    z-index:100;
    display:flex;
    gap:16px;
    padding:16px 24px;
    background:rgba(18,18,18,.95);
    backdrop-filter:blur(20px);
    border-bottom:1px solid rgba(255,255,255,.05);
    align-items:center;
}

.logo{
    font-size:28px;
    font-weight:900;
    background:linear-gradient(135deg, var(--accent), #1ed760);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    background-clip:text;
    letter-spacing:-1px;
}

.search-wrap{
    flex:1;
    max-width:500px;
    position:relative;
}

.search-wrap input{
    width:100%;
    padding:14px 20px;
    border-radius:10px;
    border:none;
    background: rgba(255, 255, 255, 0.25) !important;
    color:#fff;
    font-size:15px;
    transition:all .2s;
}

.search-wrap input:focus{
    outline:none;
    box-shadow:0 0 0 4px var(--glow);
}

/* SEARCH DROPDOWN */
.dropdown{
    position:absolute;
    top:120%;
    left:0;
    right:0;
    background:var(--panel);
    border-radius:16px;
    overflow:hidden;
    display:none;
    box-shadow:0 20px 60px rgba(0,0,0,.5);
    border:1px solid rgba(255,255,255,.1);
    max-height:400px;
    overflow-y:auto;
    z-index:1000;
}

.result{
    display:flex;
    align-items:center;
    gap:14px;
    padding:14px;
    transition:background .2s;
}

.result:hover{background:var(--hover)}

.result img{
    width:52px;
    height:52px;
    border-radius:8px;
    object-fit:cover;
}

.result-info{
    flex:1;
    min-width:0;
}

.result-info h4{
    font-size:15px;
    font-weight:600;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
}

.result-info p{
    font-size:13px;
    color:var(--muted);
}

.result-actions{
    display:flex;
    gap:8px;
}

.result button{
    background:var(--accent);
    border:none;
    color:#000;
    padding:8px 16px;
    border-radius:30px;
    font-weight:600;
    cursor:pointer;
    transition:all .2s;
    font-size:14px;
}

.result button:hover{
    background:var(--accent-dim);
    transform:scale(1.05);
}

.result .btn-add{
    background:var(--soft);
    color:var(--accent);
}

.result .btn-playlist{
    background:var(--soft);
    color:#fff;
    padding:8px 12px;
}

/* ───────── LAYOUT ───────── */
.app{
    display:flex;
    height:calc(100vh - 90px);
    position:relative;
    z-index:1;
}

/* LEFT SIDEBAR */
.sidebar{
    width:260px;
    background:rgba(18,18,18,.6);
    backdrop-filter:blur(10px);
    padding:24px;
    overflow:auto;
    border-right:1px solid rgba(255,255,255,.05);
}

.sidebar h3{
    font-size:12px;
    color:var(--muted);
    text-transform:uppercase;
    letter-spacing:1px;
    margin-bottom:16px;
}

.playlist{
    padding:12px 16px;
    border-radius:12px;
    cursor:pointer;
    transition:all .2s;
    margin-bottom:6px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    border:2px solid transparent;
}

.playlist:hover{
    background:var(--hover);
    transform:translateX(4px);
}

.playlist.active{
    background:var(--accent);
    color:#000;
    font-weight:600;
    border-color:var(--accent);
}

.playlist-delete{
    opacity:0;
    background:rgba(0,0,0,.3);
    border:none;
    color:#fff;
    padding:4px 8px;
    border-radius:6px;
    cursor:pointer;
    font-size:12px;
    transition:all .2s;
}

.playlist:hover .playlist-delete{
    opacity:1;
}

.playlist-delete:hover{
    background:rgba(255,0,0,.6);
}

.create-btn{
    margin-top:20px;
    padding:14px;
    background:linear-gradient(135deg, var(--accent), var(--accent-dim));
    border-radius:10px; !important
    text-align:center;
    cursor:pointer;
    font-weight:600;
    color:#000;
    transition:transform .2s;
}


/* MAIN */
.main{
    flex:1;
    padding:32px;
    overflow:auto;
    transition:margin-right .3s;
}

/* SECTIONS */
.section{
    margin-bottom:48px;
}

.section h2{
    margin-bottom:20px;
    font-size:28px;
    font-weight:700;
}

/* CARDS */
.row{
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(180px, 1fr));
    gap:24px;
}

.card{
    background:var(--panel);
    padding:20px;
    border-radius:16px;
    cursor:pointer;
    transition:all .3s;
    position:relative;
}

.card:hover{
    background:var(--soft);
    transform:translateY(-8px);
    box-shadow:0 12px 24px rgba(0,0,0,.5);
}

.card img{
    width:100%;
    aspect-ratio:1;
    border-radius:12px;
    margin-bottom:16px;
    object-fit:cover;
    box-shadow:0 8px 24px rgba(0,0,0,.5);
}

.card h4{
    font-size:16px;
    font-weight:700;
    margin-bottom:4px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
}

.card p{
    font-size:14px;
    color:var(--muted);
}

.card-menu{
    position:absolute;
    top:12px;
    right:12px;
    background:rgba(0,0,0,.7);
    backdrop-filter:blur(10px);
    border-radius:50%;
    width:40px;
    height:40px;
    display:flex;
    align-items:center;
    justify-content:center;
    opacity:0;
    transition:opacity .2s;
}

.card:hover .card-menu{
    opacity:1;
}

.card-menu button{
    background:none;
    border:none;
    color:#fff;
    cursor:pointer;
    font-size:20px;
}

/* QUEUE */
.queue-item{
    padding:16px;
    background:var(--panel);
    border-radius:14px;
    margin-bottom:10px;
    cursor:pointer;
    transition:all .2s;
    display:flex;
    align-items:center;
    gap:14px;
    border:2px solid transparent;
}

.queue-item:hover{
    background:var(--hover);
    transform:translateX(4px);
}

.queue-item.playing{
    border-color:var(--accent);
    background:var(--soft);
    box-shadow:0 0 20px var(--glow);
}

.queue-item img{
    width:56px;
    height:56px;
    border-radius:8px;
}

.queue-item-info{
    flex:1;
}

.queue-item-info h4{
    font-size:16px;
    font-weight:600;
}

.queue-item-info p{
    font-size:14px;
    color:var(--muted);
}

.remove-btn{
    background:var(--soft);
    border:none;
    color:var(--muted);
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
    transition:all .2s;
}

.remove-btn:hover{
    background:var(--hover);
    color:#fff;
}

/* NOW PLAYING SIDEBAR */
.now-playing{
    width:420px;
    background:rgba(18,18,18,.8);
    backdrop-filter:blur(10px);
    padding:32px;
    border-left:1px solid rgba(255,255,255,.05);
    overflow:auto;
    display:none;
}

.now-playing.active{
    display:block;
}

.video-container{
    width:100%;
    aspect-ratio:16/9;
    border-radius:16px;
    overflow:hidden;
    margin-bottom:28px;
    background:#000;
    box-shadow:0 8px 32px rgba(0,0,0,.5);
}

.video-container iframe{
    width:100%;
    height:100%;
    border:none;
}

.now-playing h3{
    font-size:24px;
    font-weight:700;
    margin-bottom:8px;
}

.now-playing .artist{
    color:var(--muted);
    font-size:18px;
    margin-bottom:32px;
}

.lyrics-section{
    margin-top:32px;
}

.lyrics-section h4{
    font-size:18px;
    margin-bottom:16px;
    color:var(--accent);
}

.lyrics{
    font-size:15px;
    color:var(--muted);
    line-height:1.8;
    white-space:pre-wrap;
    max-height:400px;
    overflow-y:auto;
    padding:20px;
    background:var(--panel);
    border-radius:16px;
}

.lyrics.loading{
    text-align:center;
    font-style:italic;
}

/* MODAL */
.modal{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.8);
    backdrop-filter:blur(10px);
    z-index:1000;
    align-items:center;
    justify-content:center;
}

.modal.active{display:flex}

.modal-content{
    background:var(--panel);
    padding:40px;
    border-radius:20px;
    max-width:400px;
    width:90%;
    border:1px solid rgba(255,255,255,.1);
}

.modal-content h3{
    margin-bottom:24px;
    font-size:28px;
    font-weight:700;
}

.modal-content input{
    width:100%;
    padding:16px;
    border-radius:30px;
    border:none;
    background:var(--soft);
    color:#fff;
    font-size:16px;
    margin-bottom:24px;
}

.modal-content input:focus{
    outline:none;
    box-shadow:0 0 0 4px var(--glow);
}

.modal-buttons{
    display:flex;
    gap:16px;
}

.modal-buttons button{
    flex:1;
    padding:16px;
    border:none;
    border-radius:30px;
    font-size:16px;
    font-weight:700;
    cursor:pointer;
    transition:all .2s;
}

.modal-buttons .primary{
    background:var(--accent);
    color:#000;
}

.modal-buttons .secondary{
    background:var(--soft);
    color:var(--text);
}

.modal-buttons button:hover{
    transform:scale(1.05);
}

/* PLAYLIST SELECTOR */
.playlist-list{
    max-height:300px;
    overflow-y:auto;
    margin-bottom:24px;
}

.playlist-option{
    padding:16px;
    background:var(--soft);
    border-radius:16px;
    margin-bottom:12px;
    cursor:pointer;
    transition:all .2s;
    display:flex;
    align-items:center;
    gap:12px;
    font-size:16px;
}

.playlist-option:hover{
    background:var(--hover);
    transform:translateX(4px);
}

/* SCROLLBAR */
::-webkit-scrollbar{width:8px;height:8px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--soft);border-radius:10px}
::-webkit-scrollbar-thumb:hover{background:var(--hover)}


.topbar {
    justify-content: space-between;  /* Pushes logo to left, search to center/right space */
    padding: 16px 24px;               /* Keeps your original padding */
}

.search-wrap {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    max-width: 500px;                 /* Keeps your original max width */
    width: 100%;
    z-index: 10;                      /* Ensures it stays on top if needed */
}

/* Make sidebar super thin - icon only mode */
.sidebar {
    width: 80px !important;     /* Very narrow */
    padding: 24px 12px;
    align-items: center;        /* Center everything vertically */
    display: flex;
    flex-direction: column;
}

.sidebar h3 {
    font-size: 11px;
    margin: 24px 0 12px 0;
    writing-mode: vertical-rl;   /* Optional: rotate text vertically */
    text-orientation: mixed;
    letter-spacing: 2px;
}

/* Home button - icon only + label below */
#homeBtn,
.playlist {
    width: 56px;
    height: auto;
    padding: 12px;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 24px;             /* Big emoji */
    position: relative;
}

#homeBtn span,
.playlist span {
    font-size: 14px;             /* Small playlist name below */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    width: 100%;
    text-align: center;
    font-weight: 500;
}

/* Hide delete button in thin mode - it would clutter */
.playlist-delete {
    display: none;
}

/* Create playlist button - smaller and centered */
.create-btn {
    width: 56px;
    height: 56px;
    border-radius: 50%;          /* Circle button */
    padding: 0;
    font-size: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 20px;
}



/* Permanent thin sidebar - no expand */
.sidebar {
    width: 80px !important;
    padding: 24px 12px;
    align-items: center;
    display: flex;
    flex-direction: column;
    transition: none !important; /* Disable any hover transition */
}

.sidebar h3 {
    font-size: 11px;
    margin: 32px 0 16px 0;
    writing-mode: vertical-rl;
    text-orientation: mixed;
    letter-spacing: 2px;
    color: var(--muted);
}

/* Home button - full circle */
#homeBtn {
    width: 56px;
    height: 56px;
    padding: 0;
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
    font-size: 26px;
    background: var(--soft);
    transition: all .2s;
}

#homeBtn:hover {
    background: var(--hover);
    transform: scale(1.05);
}

#homeBtn span {
    font-size: 11px;
    font-weight: 500;
    color: var(--muted);
}

/* Playlists - icon + name below */
.playlist {
    width: 56px;
    padding: 12px 8px;
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 6px;
    font-size: 28px;
    margin-bottom: 12px;
    transition: all .2s;
    text-align: center;
}

.playlist:hover {
    background: var(--hover);
}

.playlist.active {
    background: var(--accent);
    color: #000;
}

.playlist span {
    font-size: 11px;
    line-height: 1.3;
    max-height: 40px;           /* Limits to ~3 lines */
    overflow: hidden;
    word-break: break-word;     /* Allows long words to break */
    color: var(--text);
    width: 100%;
}

.playlist.active span {
    color: #000;
    font-weight: 600;
}

/* Hide delete button in thin mode */
.playlist-delete {
    display: none !important;
}

/* Create playlist button - full circle */
.create-btn {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    padding: 0;
    font-size: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: auto;           /* Pushes it to bottom */
    transition: all .2s;
}

.create-btn:hover {
    transform: scale(1.08);
}

/* Optional: make active playlist slightly larger circle */
.playlist.active {
    transform: scale(1.05);
}


/* Fix create button - no bottom stick, no hover changes */
.create-btn {
    width: 56px !important;
    height: 56px !important;
    border-radius: 50% !important;
    padding: 0 !important;
    font-size: 32px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    margin-top: 16px !important;  /* Fixed space above, not auto */
    margin-bottom: 24px !important; /* Fixed space below */
    transition: transform 0.2s !important; /* Only scale on hover */
}

.create-btn:hover {
    transform: scale(1.08) !important; /* Just subtle scale, no shape/size change */
}

/* Ensure playlists container doesn't push create button */
#playlists {
    flex: 1;
    overflow-y: auto;
    max-height: calc(100vh - 200px); /* Prevents overflow */
}

/* Remove any conflicting hover rules from sidebar */

/* === PERMANENT THIN SIDEBAR - NO HOVER EXPANSION AT ALL === */

/* Force sidebar to stay thin forever */
.sidebar {
    width: 80px !important;
    padding: 24px 12px !important;
    align-items: center !important;
    display: flex !important;
    flex-direction: column !important;
    transition: none !important;            /* Disable any width transition */
    overflow: hidden;
}

/* Remove ALL hover rules that cause expansion */
.sidebar:hover {
    width: 80px !important;
    padding: 24px 12px !important;
    align-items: center !important;
    transition: none !important;
}

.sidebar:hover .playlist,
.sidebar:hover #homeBtn,
.sidebar:hover .create-btn {
    flex-direction: column !important;
    width: 56px !important;
    height: auto !important;
    padding: 12px 8px !important;
    border-radius: 16px !important;
    justify-content: center !important;
}

/* Home button - always circle, no change on hover */
#homeBtn {
    width: 56px !important;
    height: 56px !important;
    padding: 0 !important;
    border-radius: 50% !important;
    background: var(--soft) !important;
    gap: 4px !important;
    font-size: 26px !important;
}

#homeBtn:hover {
    background: var(--hover) !important;
    transform: scale(1.05);
}

/* Playlist items - always vertical icon + text below */
.playlist {
    width: 56px !important;
    padding: 12px 8px !important;
    border-radius: 16px !important;
    gap: 6px !important;
    font-size: 28px !important;
    margin-bottom: 12px !important;
}

/* Active playlist highlight */
.playlist.active {
    background: var(--accent) !important;
    color: #000 !important;
    transform: scale(1.05);
}

/* Playlist name text */
.playlist span {
    font-size: 11px !important;
    line-height: 1.3;
    word-break: break-word;
    max-height: 40px;
    overflow: hidden;
}

/* Create button - fixed position, circle, no bottom stick, no hover change except scale */
.create-btn {
    width: 56px !important;
    height: 56px !important;
    border-radius: 50% !important;
    padding: 0 !important;
    font-size: 32px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    margin-top: 24px !important;   /* Space above */
    margin-bottom: 24px !important; /* Space below - keeps it centered vertically when few playlists */
    flex-shrink: 0 !important;     /* Prevents shrinking */
    transition: transform 0.2s !important;
}

.create-btn:hover {
    transform: scale(1.08) !important;
    background: var(--accent-dim) !important;  /* Optional: slight color change */
}

/* Make playlist list scrollable so + button stays in place */
#playlists {
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
}

/* Hide "Your Library" text since we're icon-only */
.sidebar h3 {
    display: none;
}

/* === FINAL: + BUTTON RIGHT BELOW HOME BUTTON === */
.sidebar {
    width: 80px !important;
    min-width: 80px !important;
    padding: 24px 12px !important;
    align-items: center !important;
    display: flex !important;
    flex-direction: column !important;
    transition: none !important;
    gap: 16px !important; /* Consistent spacing between top items */
}

.sidebar:hover {
    width: 80px !important;
    transition: none !important;
}

/* Hide "Your Library" text */
.sidebar h3 {
    display: none !important;
}

/* Home button - circle */
#homeBtn {
    width: 56px !important;
    height: 56px !important;
    padding: 0 !important;
    border-radius: 50% !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 4px !important;
    font-size: 26px !important;
    background: var(--soft) !important;
    flex-shrink: 0 !important;
}

#homeBtn:hover {
    background: var(--hover) !important;
    transform: scale(1.05) !important;
}

#homeBtn span {
    font-size: 11px !important;
    color: var(--muted) !important;
}

/* + Create button - directly below Home, same style */
.create-btn {
    width: 56px !important;
    height: 56px !important;
    border-radius: 50% !important;
    padding: 0 !important;
    font-size: 32px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    background: linear-gradient(135deg, var(--accent), var(--accent-dim)) !important;
    color: #000 !important;
    flex-shrink: 0 !important;
    transition: transform 0.2s !important;
    order: 1 !important; /* Ensures it comes right after Home */
}

.create-btn:hover {
    transform: scale(1.08) !important;
}

/* Playlists container - takes remaining space, scrolls if needed */
#playlists {
    flex: 1 1 auto !important;
    overflow-y: auto !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    width: 100% !important;
    order: 2 !important; /* Appears after Home and + button */
    margin-top: 8px !important;
}

/* Playlist items */
.playlist {
    width: 56px !important;
    padding: 12px 8px !important;
    border-radius: 16px !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 6px !important;
    font-size: 28px !important;
    margin-bottom: 12px !important;
    transition: all 0.2s !important;
}

.playlist:hover {
    background: var(--hover) !important;
}

.playlist.active {
    background: var(--accent) !important;
    color: #000 !important;
    transform: scale(1.05) !important;
}

.playlist span {
    font-size: 11px !important;
    line-height: 1.3 !important;
    word-break: break-word !important;
    max-height: 40px !important;
    overflow: hidden !important;
    text-align: center !important;
}

/* === FINAL FIX: PURPLE-TO-BLACK BACKGROUND GRADIENT + PERFECT CIRCLE BUTTONS === */

/* Animated background - purple to black, top to bottom radial gradients */

/* Sidebar locked thin forever */
.sidebar,
.sidebar:hover {
    width: 80px !important;
    min-width: 80px !important;
    max-width: 80px !important;
    padding: 24px 12px !important;
    gap: 16px !important;
    transition: none !important;
}

/* Home button - permanent perfect circle, green background kept */
#homeBtn,
#homeBtn:hover {
    width: 56px !important;
    height: 56px !important;
    min-width: 56px !important;
    min-height: 56px !important;
    padding: 0 !important;
    border-radius: 50% !important;
    background: var(--soft) !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 4px !important;
    font-size: 26px !important;
    flex-shrink: 0 !important;
    transition: background 0.2s, transform 0.2s !important;
}

#homeBtn:hover {
    background: var(--hover) !important;
    transform: scale(1.05) !important;
}

/* + Create button - permanent perfect circle, KEEP GREEN GRADIENT */
.create-btn,
.create-btn:hover {
    width: 56px !important;
    height: 56px !important;
    min-width: 56px !important;
    min-height: 56px !important;
    padding: 0 !important;
    border-radius: 50% !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    font-size: 32px !important;
    color: #000 !important;
    background: #fff !important;
    flex-shrink: 0 !important;
    order: 1 !important;
    transition: transform 0.2s !important;
}

.create-btn:hover {
    transform: scale(1.08) !important;
    background: linear-gradient(to bottom, var(--accent-dim), var(--accent)) !important; /* Slight reverse on hover for depth */
}

/* Force no distortion even if old hover rules try to interfere */
.sidebar:hover #homeBtn,
.sidebar:hover .create-btn {
    width: 56px !important;
    height: 56px !important;
    border-radius: 50% !important;
    flex-direction: column !important;
    padding: 0 !important;
}

/* Keep playlists as rounded rectangles */
.playlist,
.playlist:hover {
    border-radius: 16px !important;
}

/* === FINAL ONE-CHUNK: NO HOVER EFFECTS + TRANSPARENT BACKGROUNDS === */
.topbar {
    background: transparent !important;
    backdrop-filter: none !important;
    border-bottom: none !important;
}

.sidebar,
.sidebar:hover {
    width: 80px !important;
    min-width: 80px !important;
    max-width: 80px !important;
    background: transparent !important;
    backdrop-filter: none !important;
    border-right: none !important;
    padding: 24px 12px !important;
    gap: 16px !important;
    transition: none !important;
}

/* NO HOVER EFFECTS - NOTHING HAPPENS ON HOVER */
#homeBtn,
#homeBtn:hover,
#homeBtn:active,
.playlist,
.playlist:hover,
.playlist:active,
.create-btn,
.create-btn:hover,
.create-btn:active {
    transition: none !important;
    transform: none !important;
    background: initial !important;
    border-radius: inherit !important;
    width: inherit !important;
    height: inherit !important;
    padding: inherit !important;
    flex-direction: inherit !important;
    opacity: 1 !important;
}

/* Lock Home button as perfect circle */
#homeBtn {
    width: 56px !important;
    height: 56px !important;
    padding: 0 !important;
    border-radius: 50% !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 4px !important;
    font-size: 26px !important;
    background: var(--soft) !important;
    flex-shrink: 0 !important;
}

#homeBtn span {
    font-size: 11px !important;
    color: var(--muted) !important;
}

/* Lock + button as perfect circle with green gradient */
.create-btn {
    width: 56px !important;
    height: 56px !important;
    padding: 0 !important;
    border-radius: 50% !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    font-size: 32px !important;
    color: #000 !important;
    background: linear-gradient(to bottom, var(--accent), var(--accent-dim)) !important;
    flex-shrink: 0 !important;
    order: 1 !important;
}

/* Lock playlists */
.playlist {
    width: 56px !important;
    padding: 12px 8px !important;
    border-radius: 16px !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 6px !important;
    font-size: 28px !important;
    margin-bottom: 12px !important;
}

.playlist.active {
    background: var(--accent) !important;
    color: #000 !important;
}

.playlist span {
    font-size: 11px !important;
    line-height: 1.3 !important;
    word-break: break-word !important;
    max-height: 40px !important;
    overflow: hidden !important;
    text-align: center !important;
}

/* Playlists container */
#playlists {
    flex: 1 1 auto !important;
    overflow-y: auto !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    width: 100% !important;
    order: 2 !important;
    margin-top: 8px !important;
}

/* Hide library header */
.sidebar h3 {
    display: none !important;
}

/* Hide delete buttons */
.playlist-delete {
    display: none !important;
}

/* === FINAL: TRANSPARENT BUTTONS WITH WHITE TEXT + SUBTLE HOVER === */

/* Logo - pure white text (no gradient) */
.logo {
    background: none !important;
    -webkit-background-clip: initial !important;
    -webkit-text-fill-color: initial !important;
    background-clip: initial !important;
    color: #ffffff !important;
    font-size: 28px !important;
    font-weight: 900 !important;
    letter-spacing: -1px !important;
}

/* Home button - transparent background, white text/icon */
#homeBtn,
#homeBtn:hover {
    background: rgba(255, 255, 255, 0.08) !important;  /* Very subtle white tint */
    color: #ffffff !important;
    transition: background 0.2s !important;
}

#homeBtn span {
    color: #ffffff !important;
}

/* Hover: slightly more visible white background */
#homeBtn:hover {
    background: rgba(255, 255, 255, 0.18) !important;
}

/* + Create button - transparent background, white + icon */
.create-btn,
.create-btn:hover {
    background: rgba(255, 255, 255, 0.08) !important;
    color: #ffffff !important;
    transition: background 0.2s !important;
}

/* Hover: slightly more visible */
.create-btn:hover {
    background: rgba(255, 255, 255, 0.18) !important;
}

/* Active playlist items - keep green accent (optional: you can change if you want white too) */
.playlist.active {
    background: var(--accent) !important;
    color: #000 !important;
}

/* Normal playlist items - subtle white tint */
.playlist {
    background: rgba(255, 255, 255, 0.06) !important;
    color: #ffffff !important;
}

.playlist:hover {
    background: rgba(255, 255, 255, 0.15) !important;
}

.playlist span {
    color: #ffffff !important;
}


/* === FINAL: FULLY TRANSPARENT BUTTONS + NO MOVEMENT + NO OUTLINES === */

/* Remove any possible green outline/border from active states */
#homeBtn,
#homeBtn:hover,
#homeBtn.active,
.playlist.active {
    border: none !important;
    outline: none !important;
    box-shadow: none !important;
}

/* Home button - 100% transparent by default */
#homeBtn {
    background: transparent !important;
    color: #ffffff !important;
    transition: background 0.25s ease !important;
}

#homeBtn span {
    color: #ffffff !important;
}

/* Hover: ~25% white opacity */
#homeBtn:hover {
    background: rgba(255, 255, 255, 0.25) !important;
}

/* + Create button - 100% transparent by default, white + */
.create-btn {
    background: transparent !important;
    color: #ffffff !important;
    transition: background 0.25s ease !important;
}

/* Hover: ~25% white opacity, NO movement/scale at all */
.create-btn:hover {
    background: rgba(255, 255, 255, 0.25) !important;
    transform: none !important;   /* Stops any upward shift or scaling */
}

/* Playlists - keep subtle transparency (optional: make them fully transparent too if you want) */
.playlist {
    background: transparent !important;
    color: #ffffff !important;
    transition: background 0.25s ease !important;
}

.playlist:hover {
    background: rgba(255, 255, 255, 0.15) !important;
}

.playlist.active {
    background: rgba(29, 185, 84, 0.4) !important;  /* Keep a subtle green for active playlist */
    color: #ffffff !important;
}

.playlist span {
    color: #ffffff !important;
}

.playlist.active span {
    color: #ffffff !important;
    font-weight: 600 !important;
}
/* Make "Home" text bigger */
#homeBtn span {
    font-size: 30px !important;  /* Was 11px - now a bit larger and more readable */
    font-weight: 600 !important; /* Optional: makes it slightly bolder for better contrast */
}
/* Lighter, more visible placeholder text on transparent/dark background */
.search-wrap input::placeholder {
    color: rgba(255, 255, 255, 0.75) !important;  /* 75% opaque white - clear but soft */
    opacity: 1 !important;  /* Ensures consistency across browsers */
}

.search-wrap input:focus::placeholder {
    color: rgba(255, 255, 255, 0.5) !important;  /* Slightly fade when typing (optional, looks polished) */
}
/* Logo with small red dot accent */
.logo {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;  /* Space between dot and text */
    font-size: 28px !important;
    font-weight: 900 !important;
    color: #ffffff !important;  /* Pure white text */
    letter-spacing: -1px !important;
}

.red-accent {
    color: #ff0000 !important;  /* Bright red dot */
    font-size: 40px !important; /* Slightly smaller than text */
    animation: none !important;
}
/* Subtle noise texture overlay for depth */
body::before {
    content: '' !important;
    position: fixed !important;
    inset: 0 !important;
    background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" stitchTiles="stitch"/><feColorMatrix type="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.05 0"/></filter><rect width="100" height="100" filter="url(#noise)" opacity="0.1"/></svg>') !important;
    pointer-events: none !important;
    z-index: 0 !important;
}
    /* Force Recent section into 4x2 grid max */
#recent {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 24px;
    max-width: 900px; /* Limits to ~4 cards per row on most screens */
    margin: 0 auto;
}

/* On smaller screens, fall back gracefully */
@media (max-width: 900px) {
    #recent {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    }
}
    /* Recently Played: Fixed 4x2 left-aligned grid */
#recent {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* Forces exactly 4 columns */
    gap: 24px;
    justify-content: start;     /* Left-aligns the grid items */
    width: fit-content;         /* Prevents stretching across full width */
    max-width: 100%;            /* But don't overflow container */
    margin: 0;                  /* Remove any auto centering */
    padding: 0;
}

/* On smaller screens: fall back to 2 columns */
@media (max-width: 1100px) {
    #recent {
        grid-template-columns: repeat(2, 1fr);
    }
}

/* Mobile: 1 or 2 columns */
@media (max-width: 600px) {
    #recent {
        grid-template-columns: repeat(2, 1fr);
        justify-content: center; /* Optional: center on very small screens */
    }
}

@media (max-width: 480px) {
    #recent {
        grid-template-columns: 1fr;
        justify-content: center;
    }
}

/* Optional: limit card width for consistency */
#recent .card {
    width: 180px; /* Fixed width so they align perfectly */
}

    /* Semi-transparent song containers - lets the background gradient peek through */
.result,
.queue-item,
.card {
    background: rgba(0, 0, 0, 0.4) !important; /* Adjust the last value (0.4) for more/less transparency */
    backdrop-filter: blur(10px); /* Optional but beautiful - blurs the background behind */
    border: 1px solid rgba(255, 255, 255, 0.05); /* Subtle border for definition */
}

/* Hover states - slightly less transparent on hover for better feedback */
.result:hover,
.queue-item:hover,
.card:hover {
    background: rgba(0, 0, 0, 0.55) !important;
}

/* Playing item - keep it standing out but still semi-transparent */
.queue-item.playing {
    background: rgba(29, 185, 84, 0.25) !important; /* Subtle green tint matching your accent */
    border-color: var(--accent) !important;
    box-shadow: 0 0 20px var(--glow);
}

    /* Playlist item layout: emoji on top, name below, buttons next to name */
.playlist span {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 6px;
    width: 100%;
    font-size: 28px !important; /* emoji size */
}

.playlist-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    width: 100%;
}

.playlist-name {
    font-size: 11px !important;
    line-height: 1.3;
    word-break: break-word;
    max-height: 40px;
    overflow: hidden;
    text-align: center;
    color: #ffffff;
}

.playlist.active .playlist-name {
    color: #000;
    font-weight: 600;
}

.playlist-actions {
    display: flex;
    gap: 8px;
    opacity: 0;
    transition: opacity 0.2s;
    font-size: 14px;
}

.playlist:hover .playlist-actions {
    opacity: 1;
}

/* Style the buttons */
.playlist-actions button {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: inherit;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}

.playlist-actions button:hover {
    background: rgba(255, 255, 255, 0.3);
}

.playlist.active .playlist-actions button {
    color: #000;
}

    /* === PLAYLIST TITLE ACTIONS IN MAIN VIEW === */
.playlist-title-actions {
    display: flex;
    gap: 12px;
    margin-top: 8px;
    justify-content: flex-start;
}

.playlist-title-actions button {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: var(--text);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.playlist-title-actions button:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: scale(1.1);
}

/* === SIDEBAR PLAYLIST: EMOJI + NAME (MAX 2 LINES) === */
.playlist span {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
    width: 100%;
    padding: 0 4px;
}

.playlist .emoji {
    font-size: 28px;
    line-height: 1;
}

.playlist .playlist-name {
    font-size: 10px; /* Base size */
    line-height: 1.2;
    max-height: 2.4em; /* Exactly 2 lines */
    overflow: hidden;
    text-align: center;
    word-break: break-word;
    color: #ffffff;
    width: 100%;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

/* Active playlist text color */
.playlist.active .playlist-name {
    color: #000;
    font-weight: 600;
}

    /* Fix playlist title chopping */
#playlistTitle {
    font-size: 28px !important;
    font-weight: 700 !important;
    margin-bottom: 8px !important;
    overflow: visible !important;      /* Prevent any hidden overflow */
    white-space: normal !important;     /* Allow wrapping for very long names */
    word-break: break-word !important;  /* Break long words if needed */
    max-width: 100%;                   /* Fit within container */
    line-height: 1.2 !important;
}

/* Ensure the section container doesn't clip it */
.section h2 {
    overflow: visible !important;
    width: 100%;
}

    /* Fix sidebar playlist name clipping - show full 2 lines properly */
.playlist .playlist-name {
    font-size: 11px !important;           /* Slightly larger for readability */
    line-height: 1.4 !important;          /* Proper spacing */
    max-height: 2.8em !important;         /* Exactly 2 lines (2 × 1.4) */
    overflow: hidden;
    text-align: center;
    word-break: break-word;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    padding: 0 4px;
    width: 100%;
}

/* Ensure the container has enough height */
.playlist span {
    gap: 6px !important;
    padding: 8px 4px !important;
    height: auto !important;
}
    #playlistEmoji {
    font-family: 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif;
}


    /* === ENHANCED VISUAL POLISH === */

/* Smooth fade-in for cards */
.card {
    animation: fadeInUp 0.5s ease backwards;
}

.card:nth-child(1) { animation-delay: 0.05s; }
.card:nth-child(2) { animation-delay: 0.1s; }
.card:nth-child(3) { animation-delay: 0.15s; }
.card:nth-child(4) { animation-delay: 0.2s; }
.card:nth-child(5) { animation-delay: 0.25s; }
.card:nth-child(6) { animation-delay: 0.3s; }
.card:nth-child(7) { animation-delay: 0.35s; }
.card:nth-child(8) { animation-delay: 0.4s; }

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Better depth and shadows */
.card {
    background: rgba(255,255,255,.04);
    border: 1px solid transparent;
    box-shadow: 0 4px 12px rgba(0,0,0,.3);
    transition: all .4s cubic-bezier(0.4, 0, 0.2, 1);
}

.card:hover {
    background: rgba(255,255,255,.08);
    border-color: rgba(255,255,255,.08);
    box-shadow: 0 20px 40px rgba(0,0,0,.6), 0 0 0 1px rgba(255,255,255,.06);
}

.card img {
    transition: transform .4s cubic-bezier(0.4, 0, 0.2, 1);
}

.card:hover img {
    transform: scale(1.02);
}

/* Queue items refined */
.queue-item {
    transition: all .3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid transparent;
}

.queue-item:hover {
    border-color: rgba(255,255,255,.08);
    box-shadow: 0 4px 12px rgba(0,0,0,.3);
}

.queue-item.playing {
    box-shadow: 0 0 30px rgba(29,185,84,.25), 0 4px 12px rgba(0,0,0,.4);
}

/* Smooth modal entrance */
.modal.active .modal-content {
    animation: modalSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: scale(0.95) translateY(-10px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

/* Enhanced scrollbar */
::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

::-webkit-scrollbar-track {
    background: rgba(255,255,255,.02);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb {
    background: rgba(255,255,255,.12);
    border-radius: 10px;
    border: 2px solid transparent;
    background-clip: padding-box;
}

::-webkit-scrollbar-thumb:hover {
    background: rgba(255,255,255,.2);
    background-clip: padding-box;
}

/* Better focus states */
input:focus,
button:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
}

/* Search input enhancement */
.search-wrap input {
    background: rgba(255, 255, 255, 0.06) !important;
    border: 1px solid rgba(255,255,255,.08);
    transition: all .3s cubic-bezier(0.4, 0, 0.2, 1);
}

.search-wrap input:focus {
    background: rgba(255, 255, 255, 0.1) !important;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(29,185,84,.15);
}

/* Result items polish */
.result {
    border: 1px solid transparent;
    transition: all .3s cubic-bezier(0.4, 0, 0.2, 1);
}

.result:hover {
    border-color: rgba(255,255,255,.08);
    box-shadow: 0 2px 8px rgba(0,0,0,.2);
}

/* Video container enhancement */
.video-container {
    box-shadow: 0 12px 40px rgba(0,0,0,.6);
    border: 1px solid rgba(255,255,255,.08);
}

/* Lyrics section polish */
.lyrics {
    border: 1px solid rgba(255,255,255,.08);
    box-shadow: inset 0 2px 8px rgba(0,0,0,.3);
}

/* Button interactions */
button {
    transition: all .25s cubic-bezier(0.4, 0, 0.2, 1);
}

button:active {
    transform: scale(0.96);
}

/* Typography refinement */
.section h2 {
    font-weight: 700;
    letter-spacing: -0.03em;
}

.card h4 {
    font-weight: 600;
    letter-spacing: -0.02em;
}

    /* === ENHANCED VISUAL POLISH === */

/* Color refinements */
:root{
    --bg:#0a0a0a;
    --panel:#161616;
    --soft:#1f1f1f;
    --hover:#2a2a2a;
    --muted:#8a8a8a;
    --border:rgba(255,255,255,.06);
    --shadow-sm:0 2px 8px rgba(0,0,0,.4);
    --shadow-md:0 8px 24px rgba(0,0,0,.5);
    --shadow-lg:0 20px 40px rgba(0,0,0,.7);
}

/* Better typography */
body {
    font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;
    letter-spacing:-0.01em;
    -webkit-font-smoothing:antialiased;
}

/* Refined background with subtle grain */
.bg-gradient::after{
    content:'';
    position:absolute;
    inset:0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.2' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.025'/%3E%3C/svg%3E");
    pointer-events:none;
    opacity:0.5;
}

/* Enhanced topbar */
.topbar {
    padding:20px 32px;
    background:rgba(10,10,10,.85);
    backdrop-filter:blur(24px) saturate(180%);
    border-bottom:1px solid var(--border);
}

/* Better search input */
.search-wrap input {
    padding:13px 20px 13px 46px;
    border:1px solid var(--border);
    background: rgba(255, 255, 255, 0.04) !important;
    font-size:14px;
    border-radius:10px;
    transition:all .3s cubic-bezier(0.4, 0, 0.2, 1);
}

.search-wrap input:focus {
    background: rgba(255, 255, 255, 0.08) !important;
    border-color:var(--accent);
    box-shadow:0 0 0 3px rgba(29,185,84,.12);
}

.search-wrap::before {
    left:16px;
    font-size:17px;
    color:var(--muted);
}

/* Refined dropdown */
.dropdown {
    background:rgba(22,22,22,.98);
    backdrop-filter:blur(24px) saturate(180%);
    border-radius:12px;
    box-shadow:var(--shadow-lg);
    border:1px solid var(--border);
}

.result {
    padding:12px 14px;
    transition:all .25s cubic-bezier(0.4, 0, 0.2, 1);
    border-bottom:1px solid rgba(255,255,255,.03);
}

.result:last-child {
    border-bottom:none;
}

.result:hover {
    background:rgba(255,255,255,.06);
}

.result img {
    border-radius:6px;
    box-shadow:var(--shadow-sm);
}

.result-info h4 {
    font-size:14px;
    letter-spacing:-0.01em;
    margin-bottom:3px;
}

.result-info p {
    font-size:12px;
}

.result button {
    padding:7px 14px;
    border-radius:20px;
    font-size:13px;
    transition:all .25s cubic-bezier(0.4, 0, 0.2, 1);
}

.result button:hover {
    transform:translateY(-1px);
    box-shadow:0 4px 12px rgba(29,185,84,.3);
}

.result button:active {
    transform:translateY(0);
}

.result .btn-add {
    background:rgba(255,255,255,.08);
    color:var(--accent);
}

.result .btn-add:hover {
    background:rgba(255,255,255,.12);
}

.result .btn-playlist {
    background:rgba(255,255,255,.08);
    padding:7px 11px;
}

.result .btn-playlist:hover {
    background:rgba(255,255,255,.12);
}

/* Better main content spacing */
.main {
    padding:40px 48px;
}

.section {
    margin-bottom:56px;
}

.section h2 {
    margin-bottom:24px;
    font-size:26px;
    letter-spacing:-0.03em;
}

/* Enhanced cards */
.card {
    background:rgba(255,255,255,.03);
    padding:16px;
    border-radius:12px;
    border:1px solid transparent;
    transition:all .35s cubic-bezier(0.4, 0, 0.2, 1);
    animation: fadeInUp 0.5s ease backwards;
}

.card:nth-child(1) { animation-delay: 0.05s; }
.card:nth-child(2) { animation-delay: 0.1s; }
.card:nth-child(3) { animation-delay: 0.15s; }
.card:nth-child(4) { animation-delay: 0.2s; }
.card:nth-child(5) { animation-delay: 0.25s; }
.card:nth-child(6) { animation-delay: 0.3s; }
.card:nth-child(7) { animation-delay: 0.35s; }
.card:nth-child(8) { animation-delay: 0.4s; }

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.card:hover {
    background:rgba(255,255,255,.06);
    transform:translateY(-4px);
    box-shadow:0 16px 32px rgba(0,0,0,.6), 0 0 0 1px var(--border);
    border-color:var(--border);
}

.card img {
    border-radius:10px;
    box-shadow:var(--shadow-sm);
    transition:transform .35s cubic-bezier(0.4, 0, 0.2, 1);
}

.card:hover img {
    transform:scale(1.02);
}

.card h4 {
    font-size:15px;
    letter-spacing:-0.02em;
    margin-bottom:6px;
}

.card p {
    font-size:13px;
    font-weight:500;
}

/* Queue items refined */
.queue-item {
    background:rgba(255,255,255,.03);
    border-radius:12px;
    padding:14px;
    border:1px solid transparent;
    transition:all .3s cubic-bezier(0.4, 0, 0.2, 1);
}

.queue-item:hover {
    background:rgba(255,255,255,.06);
    border-color:var(--border);
    box-shadow:var(--shadow-sm);
}

.queue-item.playing {
    border-color:var(--accent);
    background:rgba(29,185,84,.08);
    box-shadow:0 0 30px rgba(29,185,84,.2), var(--shadow-sm);
}

.queue-item img {
    border-radius:8px;
    box-shadow:var(--shadow-sm);
}

.queue-item-info h4 {
    font-size:15px;
    letter-spacing:-0.01em;
}

.queue-item-info p {
    font-size:13px;
}

/* Better buttons */
button {
    transition:all .25s cubic-bezier(0.4, 0, 0.2, 1);
}

button:active {
    transform:scale(0.96);
}

.remove-btn {
    background:rgba(255,255,255,.06);
    border-radius:6px;
    transition:all .25s cubic-bezier(0.4, 0, 0.2, 1);
}

.remove-btn:hover {
    background:rgba(255,59,48,.2);
    color:#ff3b30;
}

/* Modal enhancements */
.modal {
    backdrop-filter:blur(16px);
}

.modal.active .modal-content {
    animation: modalSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: scale(0.95) translateY(-10px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

.modal-content {
    background:var(--panel);
    border-radius:16px;
    border:1px solid var(--border);
    box-shadow:var(--shadow-lg);
}

.modal-content h3 {
    font-size:24px;
    letter-spacing:-0.02em;
}

.modal-content input {
    background:rgba(255,255,255,.06);
    border:1px solid var(--border);
    border-radius:10px;
    transition:all .25s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal-content input:focus {
    background:rgba(255,255,255,.08);
    border-color:var(--accent);
    box-shadow:0 0 0 3px rgba(29,185,84,.12);
}

.modal-buttons button {
    border-radius:10px;
    font-size:15px;
    transition:all .25s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal-buttons button:hover {
    transform:translateY(-1px);
}

.modal-buttons .primary:hover {
    box-shadow:0 4px 12px rgba(29,185,84,.3);
}

.modal-buttons .secondary {
    background:rgba(255,255,255,.06);
}

.modal-buttons .secondary:hover {
    background:rgba(255,255,255,.1);
}

/* Playlist options */
.playlist-option {
    background:rgba(255,255,255,.04);
    border-radius:12px;
    border:1px solid transparent;
    transition:all .25s cubic-bezier(0.4, 0, 0.2, 1);
}

.playlist-option:hover {
    background:rgba(255,255,255,.08);
    border-color:var(--border);
}

/* Now playing sidebar */
.now-playing {
    background:rgba(10,10,10,.9);
    backdrop-filter:blur(24px) saturate(180%);
    border-left:1px solid var(--border);
}

.video-container {
    border-radius:12px;
    box-shadow:var(--shadow-lg);
    border:1px solid var(--border);
}

.now-playing h3 {
    font-size:22px;
    letter-spacing:-0.02em;
}

.now-playing .artist {
    font-size:16px;
}

.lyrics-section h4 {
    font-size:16px;
    letter-spacing:-0.01em;
}

.lyrics {
    background:rgba(255,255,255,.03);
    border:1px solid var(--border);
    border-radius:12px;
    box-shadow:inset 0 2px 8px rgba(0,0,0,.3);
    font-size:14px;
    line-height:1.8;
}

/* Enhanced scrollbar */
::-webkit-scrollbar {
    width:10px;
    height:10px;
}

::-webkit-scrollbar-track {
    background:rgba(255,255,255,.01);
    border-radius:10px;
}

::-webkit-scrollbar-thumb {
    background:rgba(255,255,255,.1);
    border-radius:10px;
    border:2px solid transparent;
    background-clip:padding-box;
}

::-webkit-scrollbar-thumb:hover {
    background:rgba(255,255,255,.18);
    background-clip:padding-box;
}

/* Better focus states */
input:focus-visible,
button:focus-visible {
    outline:2px solid var(--accent);
    outline-offset:2px;
}

/* Card menu refinement */
.card-menu {
    background:rgba(0,0,0,.8);
    backdrop-filter:blur(12px);
    border-radius:8px;
    width:36px;
    height:36px;
    box-shadow:var(--shadow-sm);
}

.card-menu button {
    font-size:18px;
}

/* Playlist title actions */
.playlist-title-actions button {
    background:rgba(255,255,255,.06);
    border:1px solid transparent;
    width:40px;
    height:40px;
    border-radius:10px;
    transition:all .25s cubic-bezier(0.4, 0, 0.2, 1);
}

.playlist-title-actions button:hover {
    background:rgba(255,255,255,.12);
    border-color:var(--border);
    transform:translateY(-1px);
}




    /* ─────────────── FULL-BLEED VIDEO IN RIGHT SIDEBAR ─────────────── */

/* Make sidebar itself have no internal padding (critical for zero gaps) */
.now-playing {
    padding: 0 !important;
    margin: 0;
    background: #000;               /* solid black base so no bleed-through */
    overflow: hidden;               /* prevent scrollbars or overflow */
}

/* Video container fills entire sidebar top-to-bottom */
.video-container {
    width: 100%;
    height: 100%;                   /* ← changed: full height of sidebar */
    margin: 0 !important;
    padding: 0 !important;
    border-radius: 0 !important;    /* no rounded corners */
    background: #000;
    overflow: hidden;
    position: relative;             /* for absolute overlay */
}

/* Iframe fills container completely + crops to fit */
.video-container iframe {
    position: absolute;
    inset: 0;
    width: 100% !important;
    height: 100% !important;
    border: none;
    object-fit: cover;              /* key: fills + crops, keeps ratio */
}

/* Subtle dark overlay over the whole video (adjust opacity 0.3–0.55) */
.video-container::after {
    content: "";
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.45);   /* ← tune this: 0.35 = subtle, 0.6 = much darker */
    pointer-events: none;
    z-index: 1;
}

/* Title + artist stay BELOW video (your current position), but now video is taller */
.now-playing h3,
.now-playing .artist {
    position: relative;
    z-index: 2;                     /* above any future overlays if needed */
    margin: 20px 0 0 0;             /* keep your original spacing feel */
    padding: 0 32px;                /* matches old sidebar padding feel */
}

/* Lyrics section follows naturally below title/artist */
.lyrics-section {
    margin-top: 24px;               /* slight breathing room after artist */
    padding: 0 32px 32px 32px;      /* consistent with old look */
}

/* Optional: make title/artist pop more on darker video bg */
#npTitle {
    color: #fff;
    text-shadow: 0 2px 12px rgba(0,0,0,0.9);
}
#npArtist {
    color: #ddd;
    text-shadow: 0 1px 8px rgba(0,0,0,0.8);
}

    /* ─────────────── RIGHT SIDEBAR – FULL VIDEO + OVERLAY TITLE ─────────────── */

/* Sidebar container: no padding → video can touch every edge */
.now-playing {
    padding: 0 !important;
    margin: 0;
    background: #000;
    overflow: hidden;
    display: none;           /* still controlled by .active */
    flex-direction: column;
}

/* When active → show as flex so children can stretch properly */
.now-playing.active {
    display: flex !important;
}

/* Video container takes 100% of sidebar (grow to fill) */
.video-container {
    position: relative;
    flex: 1 1 auto;               /* ← grows to fill available space */
    width: 100%;
    height: 100%;                 /* ← critical: full height */
    margin: 0 !important;
    padding: 0 !important;
    border-radius: 0 !important;
    overflow: hidden;
    background: #000;
}

/* Iframe must completely fill + cover (crops if needed, no black bars) */
.video-container iframe {
    position: absolute !important;
    inset: 0 !important;
    width: 100% !important;
    height: 100% !important;
    border: none !important;
    object-fit: cover !important;     /* ← fills container, maintains ratio, crops edges */
}

/* Dark overlay over whole video (subtle dimming) */
.video-container::after {
    content: "";
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.42);   /* 0.35–0.55 range; tune darkness */
    pointer-events: none;
    z-index: 1;
}

/* Title + artist overlay – positioned over bottom of video */
.now-playing > h3#npTitle,
.now-playing > .artist {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    margin: 0 !important;
    padding: 80px 32px 28px 32px;     /* large top padding = gradient space */
    background: linear-gradient(to top, rgba(0,0,0,0.92) 40%, transparent);
    z-index: 3;                        /* above overlay & video */
    text-align: left;
}

/* Song title styling */
#npTitle {
    font-size: 26px;
    font-weight: 800;
    margin: 0 0 6px 0 !important;
    color: #ffffff;
    line-height: 1.15;
    text-shadow: 0 3px 14px rgba(0,0,0,0.95);
    letter-spacing: -0.4px;
}

/* Artist styling */
.artist {
    font-size: 16px;
    color: rgba(255,255,255,0.88);
    margin: 0 !important;
    text-shadow: 0 2px 10px rgba(0,0,0,0.9);
}

/* Lyrics below the video area */
.lyrics-section {
    padding: 24px 32px 32px 32px;
    background: #0a0a0a;
    flex: 0 0 auto;               /* doesn't grow */
    overflow-y: auto;
}

/* Make sure lyrics don't fight for space */
.lyrics {
    font-size: 15px;
    line-height: 1.8;
}


    /* ─────────────── RIGHT SIDEBAR – VIDEO FULL BLEED + BOTTOM OVERLAY ─────────────── */

.now-playing {
    padding: 0 !important;
    margin: 0;
    background: #000;
    overflow: hidden;
}

.now-playing.active {
    display: flex !important;
    flex-direction: column;
}

/* Video takes 100% of sidebar */
.video-container {
    position: relative;
    flex: 1 1 100%;               /* grows to fill all available height */
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #000;
}

.video-container iframe {
    position: absolute;
    inset: 0;
    width: 100% !important;
    height: 100% !important;
    border: none;
    object-fit: cover;            /* fills container, crops edges if needed */
}

/* Subtle darkening overlay over whole video */
.video-container::before {
    content: "";
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.38);   /* 0.3 = light dim, 0.5 = stronger */
    z-index: 1;
    pointer-events: none;
}

/* Overlay wrapper for title + artist at bottom */
.now-playing-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 3;                    /* above video + dim overlay */
    padding: 70px 32px 28px 32px;  /* large top padding = space for gradient */
    background: linear-gradient(to top, rgba(0,0,0,0.95) 45%, transparent 100%);
    pointer-events: none;          /* clicks go through to video if needed */
}

/* Song title – white, full visibility, no cutoff */
#npTitle {
    font-size: 26px;
    font-weight: 800;
    line-height: 1.15;
    margin: 0 0 8px 0;
    color: #ffffff;
    text-shadow: 0 3px 16px rgba(0,0,0,0.95);
    letter-spacing: -0.3px;
    white-space: normal;           /* allow wrapping */
    overflow: visible !important;
    text-overflow: unset !important;
    max-width: 100%;
}

/* Artist – slightly smaller, still clear */
#npArtist.artist {
    font-size: 16px;
    font-weight: 500;
    color: rgba(255,255,255,0.92);
    margin: 0;
    text-shadow: 0 2px 12px rgba(0,0,0,0.9);
    white-space: normal;
    overflow: visible !important;
}

/* Hide lyrics completely (JS still runs, no problem) */
.lyrics-section,
.lyrics-section * {
    display: none !important;
}
</style>

</head>

<body>

<div class="bg-gradient"></div>

<div class="topbar">
    <div class="logo">
    <span class="red-accent">•</span> TUNΞS
</div>
    <div class="search-wrap">
        <input id="search" placeholder="⌕ What do you want to play?…">
        <div id="dropdown" class="dropdown"></div>
    </div>
</div>

<div class="app">

<aside class="sidebar">
    <div class="playlist" onclick="goHome()" id="homeBtn">
        <span>⌂</span>
    </div>
    <div id="playlists"></div>
    <div class="create-btn" onclick="openModal()">＋</div>
</aside>

<main class="main" id="main">

<div id="homePage">
<div class="section">
    <h2>Jump Back in!</h2>
    <div class="row" id="recent"></div>
</div>

<div class="section">
    <h2>Next Up</h2>
    <div id="queue"></div>
</div>
</div>

<div id="playlistPage" style="display:none">
<div class="section">
    <h2 id="playlistTitle"></h2>
    <div id="playlistContent"></div>
</div>
</div>

</main>

<aside id="nowPlaying" class="now-playing">
    <div class="video-container">
        <iframe id="player" allow="autoplay; encrypted-media"></iframe>
        
        <!-- Title + artist moved here → will overlay bottom of video -->
        <div class="now-playing-overlay">
            <h3 id="npTitle"></h3>
            <div id="npArtist" class="artist"></div>
        </div>
    </div>

    <!-- Lyrics section stays in HTML/JS but will be hidden via CSS -->
    <div class="lyrics-section">
        <h4>Lyrics</h4>
        <div id="lyrics" class="lyrics loading">Play a song to view lyrics...</div>
    </div>

    <!-- your bgPlayer iframe if still there -->
</aside>

</div>

<!-- UPDATED CREATE PLAYLIST MODAL -->
<div id="modal" class="modal">
    <div class="modal-content">
        <h3>Create Playlist</h3>
        <input id="playlistName" placeholder="Playlist name" style="margin-bottom:16px;">
        <input id="playlistEmoji" placeholder="Emoji (e.g. 🔥 🎸 ❤️)" maxlength="2" style="margin-bottom:24px; font-size:20px; text-align:center;">
        <div class="modal-buttons">
            <button class="secondary" onclick="closeModal()">Cancel</button>
            <button class="primary" onclick="createPlaylist()">Create</button>
        </div>
    </div>
</div>

<!-- ADD TO PLAYLIST MODAL -->
<div id="playlistModal" class="modal">
    <div class="modal-content">
        <h3>Add to Playlist</h3>
        <div id="playlistList" class="playlist-list"></div>
        <div class="modal-buttons">
            <button class="secondary" onclick="closePlaylistModal()">Cancel</button>
        </div>
    </div>
</div>

<script>
const YT_KEY = "AIzaSyDNd7dwB1rZEpJzpyRrVZQwSKHvnt3Q7vQ";

// Storage with validation
function saveData(key, data) {
    try {
        localStorage.setItem(key, JSON.stringify(data));
    } catch (e) {
        console.error("Storage error:", e);
    }
}

function loadData(key, defaultVal) {
    try {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : defaultVal;
    } catch (e) {
        console.error("Load error:", e);
        return defaultVal;
    }
}

// State
let queue = loadData("queue", []);
let index = loadData("index", -1);
let recent = loadData("recent", []);
let playlists = loadData("playlists", {});
let currentPlaylist = null;
let songToAdd = null;
let currentPage = 'home';

// Elements
const searchInput = document.getElementById("search");
const dropdown = document.getElementById("dropdown");
const queueDiv = document.getElementById("queue");
const recentDiv = document.getElementById("recent");
const playlistsDiv = document.getElementById("playlists");
const player = document.getElementById("player");
const modal = document.getElementById("modal");
const playlistModal = document.getElementById("playlistModal");
const nowPlaying = document.getElementById("nowPlaying");
const mainDiv = document.getElementById("main");
const homePage = document.getElementById("homePage");
const playlistPage = document.getElementById("playlistPage");
const playlistTitle = document.getElementById("playlistTitle");
const playlistContent = document.getElementById("playlistContent");
const homeBtn = document.getElementById("homeBtn");

/* SEARCH */
let searchTimeout;
searchInput.oninput = async () => {
    clearTimeout(searchTimeout);
    const q = searchInput.value.trim();
    
    if (!q) {
        dropdown.style.display = "none";
        return;
    }
    
    searchTimeout = setTimeout(async () => {
        try {
            const data = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&videoCategoryId=10&maxResults=6&q=${encodeURIComponent(q)}&key=${YT_KEY}`).then(r => r.json());
            
            dropdown.innerHTML = "";
            
            if (data.items && data.items.length > 0) {
                data.items.forEach(v => {
                    const thumb = v.snippet.thumbnails.medium.url;
                    const title = escapeHtml(v.snippet.title);
                    const artist = escapeHtml(v.snippet.channelTitle);
                    
                    const song = {
                        id: v.id.videoId,
                        title: title,
                        artist: artist,
                        art: thumb
                    };
                    
                    const div = document.createElement("div");
                    div.className = "result";
                    div.innerHTML = `
                        <img src="${thumb}">
                        <div class="result-info">
                            <h4>${title}</h4>
                            <p>${artist}</p>
                        </div>
                        <div class="result-actions">
                            <button onclick='playNow(${JSON.stringify(song)})'>▶</button>
                            <button class="btn-add" onclick='addQueue(${JSON.stringify(song)})'>＋ Queue</button>
                            <button class="btn-playlist" onclick='openAddToPlaylist(${JSON.stringify(song)})'>📁</button>
                        </div>
                    `;
                    dropdown.appendChild(div);
                });
                dropdown.style.display = "block";
            } else {
                dropdown.innerHTML = '<div style="padding:20px;text-align:center;color:var(--muted)">No results found</div>';
                dropdown.style.display = "block";
            }
        } catch (error) {
            console.error("Search error:", error);
            dropdown.innerHTML = '<div style="padding:20px;text-align:center;color:var(--muted)">Search error. Please try again.</div>';
            dropdown.style.display = "block";
        }
    }, 300);
};

// Close dropdown when clicking outside
document.addEventListener('click', (e) => {
    if (!searchInput.contains(e.target) && !dropdown.contains(e.target)) {
        dropdown.style.display = "none";
    }
});

/* PLAYBACK */
function playNow(song) {
    player.src = `https://www.youtube.com/embed/${song.id}?autoplay=1&enablejsapi=1`;
    nowPlaying.classList.add('active');
    mainDiv.classList.add('with-sidebar');
    
    document.getElementById("npTitle").textContent = song.title;
    document.getElementById("npArtist").textContent = song.artist;
    
    addRecent(song);
    fetchLyrics(song.title, song.artist);
    
    // Update index based on current context
if (currentPlaylist) {
    const playlistSongs = playlists[currentPlaylist].songs;
    index = playlistSongs.findIndex(s => s.id === song.id);
} else {
        index = queue.findIndex(s => s.id === song.id);
    }
    
    saveData("index", index);
    
    if (currentPage === 'home') {
        renderQueue();
    } else {
        renderPlaylistContent();
    }
    
    dropdown.style.display = "none";
    
    // Setup autoplay listener
    setupAutoplay();
}

function addQueue(song) {
    queue.push(song);
    saveData("queue", queue);
    if (currentPage === 'home') {
        renderQueue();
    }
    dropdown.style.display = "none";
}

function playQueue(i) {
    index = i;
    const songs = currentPlaylist ? playlists[currentPlaylist].songs : queue;

    playNow(songs[i]);
}

function removeFromQueue(i) {
    queue.splice(i, 1);
    if (index >= i) index--;
    saveData("queue", queue);
    saveData("index", index);
    renderQueue();
}

/* AUTOPLAY */
function setupAutoplay() {
    // YouTube IFrame API auto-loads, we just need to listen for video end
    // We'll use a simpler approach with polling
    const checkInterval = setInterval(() => {
        try {
            // Check if player iframe exists
            if (!player.src) {
                clearInterval(checkInterval);
                return;
            }
            
            // We can't directly access YouTube player state without the API
            // So we'll set a timeout based on typical song length
            // Better solution: use YouTube IFrame API properly
        } catch (e) {
            clearInterval(checkInterval);
        }
    }, 1000);
}

// YouTube IFrame API
let ytPlayer;
function onYouTubeIframeAPIReady() {
    ytPlayer = new YT.Player('player', {
        events: {
            'onStateChange': onPlayerStateChange
        }
    });
}

function onPlayerStateChange(event) {
    // 0 = ended
    if (event.data === 0) {
        playNext();
    }
}

function playNext() {
    const songs = currentPlaylist ? playlists[currentPlaylist] : queue;
    
    if (index < songs.length - 1) {
        index++;
        playNow(songs[index]);
    }
}

// Load YouTube IFrame API
if (!window.YT) {
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    const firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
}

/* LYRICS */
async function fetchLyrics(title, artist) {
    const lyricsDiv = document.getElementById("lyrics");
    lyricsDiv.className = "lyrics loading";
    lyricsDiv.textContent = "Loading lyrics...";
    
    try {
        // Using lyrics.ovh API (free, no key required)
        const cleanArtist = artist.split('-')[0].split('(')[0].trim();
        const cleanTitle = title.split('(')[0].split('[')[0].split('|')[0].trim();
        
        const response = await fetch(`https://api.lyrics.ovh/v1/${encodeURIComponent(cleanArtist)}/${encodeURIComponent(cleanTitle)}`);
        const data = await response.json();
        
        if (data.lyrics) {
            lyricsDiv.className = "lyrics";
            lyricsDiv.textContent = data.lyrics;
        } else {
            lyricsDiv.className = "lyrics loading";
            lyricsDiv.textContent = "Lyrics not available for this song";
        }
    } catch (error) {
        lyricsDiv.className = "lyrics loading";
        lyricsDiv.textContent = "Couldn't load lyrics";
    }
}

/* RECENT */
function addRecent(song) {
    recent = recent.filter(s => s.id !== song.id);
    recent.unshift(song);
    recent = recent.slice(0, 12);
    saveData("recent", recent);
    renderRecent();
}

/* PLAYLISTS */
function goHome() {
    currentPage = 'home';
    currentPlaylist = null;
    homePage.style.display = 'block';
    playlistPage.style.display = 'none';
    homeBtn.classList.add('active');
    renderPlaylists();
    renderQueue();
}

function openAddToPlaylist(song) {
    songToAdd = song;
    const listDiv = document.getElementById("playlistList");
    listDiv.innerHTML = "";
    
    if (Object.keys(playlists).length === 0) {
        listDiv.innerHTML = '<div style="padding:20px;text-align:center;color:var(--muted)">No playlists yet. Create one first!</div>';
    } else {
        Object.keys(playlists).forEach(name => {
            const div = document.createElement("div");
            div.className = "playlist-option";
            div.innerHTML = `📁 ${escapeHtml(name)}`;
            div.onclick = () => addToPlaylist(name);
            listDiv.appendChild(div);
        });
    }
    
    playlistModal.classList.add("active");
}

function addToPlaylist(name) {
    if (!songToAdd) return;
    
    // Check if song already in playlist
    if (!playlists[name].songs.some(s => s.id === songToAdd.id)) {
        playlists[name].songs.push(songToAdd);
        saveData("playlists", playlists);
    }
    
    closePlaylistModal();
    
    // If this playlist is currently selected, refresh view
    if (currentPlaylist === name) {
        renderPlaylistContent();
    }
}

function closePlaylistModal() {
    playlistModal.classList.remove("active");
    songToAdd = null;
}

function viewPlaylist(name) {
    currentPage = 'playlist';
    currentPlaylist = name;
    homePage.style.display = 'none';
    playlistPage.style.display = 'block';
    
    playlistTitle.textContent = name;
    renderPlaylistContent();
    renderPlaylists();
}

function deletePlaylist(name, event) {
    event.stopPropagation();
    if (confirm(`Delete playlist "${name}"?`)) {
        delete playlists[name];
        saveData("playlists", playlists);
        
        if (currentPlaylist === name) {
            goHome();
        }
        
        renderPlaylists();
    }
}

function removeFromPlaylist(name, i) {
    playlists[name].songs.splice(i, 1);
    saveData("playlists", playlists);
    renderPlaylistContent();
}

/* MODAL */
function openModal() {
    modal.classList.add("active");
    document.getElementById("playlistName").focus();
}

function closeModal() {
    modal.classList.remove("active");
    document.getElementById("playlistName").value = "";
}

function createPlaylist() {
    const name = document.getElementById("playlistName").value.trim();
    const emoji = document.getElementById("playlistEmoji").value.trim() || '📁';
    
    if (!name) return;
    
if (playlists[name]) {
    alert("A playlist with this name already exists!");
    return;
}
    
    // Store as object with emoji and songs array
playlists[name] = {
    emoji: emoji,
    songs: []
};
    
    saveData("playlists", playlists);
    renderPlaylists();
    closeModal();
    
    // Clear the emoji input too
    document.getElementById("playlistEmoji").value = "";
}

/* RENDER */
function renderQueue() {
    queueDiv.innerHTML = "";
    
    if (queue.length === 0) {
        queueDiv.innerHTML = '<div style="padding:40px;text-align:center;color:var(--muted)">No songs here. Search and add some!</div>';
        return;
    }
    
    queue.forEach((s, i) => {
        const d = document.createElement("div");
        d.className = "queue-item" + (i === index && !currentPlaylist ? " playing" : "");
        d.innerHTML = `
            <img src="${s.art}">
            <div class="queue-item-info">
                <h4>${s.title}</h4>
                <p>${s.artist}</p>
            </div>
            <button class="remove-btn" onclick="event.stopPropagation(); removeFromQueue(${i})">✕</button>
        `;
        d.onclick = () => {
            currentPlaylist = null;
            playQueue(i);
        };
        queueDiv.appendChild(d);
    });
}

function renderPlaylistContent() {
    playlistContent.innerHTML = "";
    
    if (!currentPlaylist || !playlists[currentPlaylist]) {
        goHome();
        return;
    }
    
   const songs = playlists[currentPlaylist].songs;
    
    if (songs.length === 0) {
        playlistContent.innerHTML = '<div style="padding:40px;text-align:center;color:var(--muted)">No songs in this playlist yet. Add some!</div>';
        return;
    }
    
    songs.forEach((s, i) => {
        const d = document.createElement("div");
        d.className = "queue-item" + (i === index && currentPlaylist ? " playing" : "");
        d.innerHTML = `
            <img src="${s.art}">
            <div class="queue-item-info">
                <h4>${s.title}</h4>
                <p>${s.artist}</p>
            </div>
            <button class="remove-btn" onclick="event.stopPropagation(); removeFromPlaylist('${escapeHtml(currentPlaylist)}', ${i})">✕</button>
        `;
        d.onclick = () => playQueue(i);
        playlistContent.appendChild(d);
    });
}

function renderRecent() {
    recentDiv.innerHTML = "";
   
    if (recent.length === 0) {
        recentDiv.innerHTML = '<div style="padding:40px;text-align:center;color:var(--muted);grid-column:1/-1">No recent songs yet</div>';
        return;
    }

    // Only show the latest 8 songs
    const latestEight = recent.slice(0, 8);

    latestEight.forEach(s => {
        const c = document.createElement("div");
        c.className = "card";
        c.innerHTML = `
            <div class="card-menu">
                <button onclick="event.stopPropagation(); openAddToPlaylist(${JSON.stringify(s).replace(/"/g, '&quot;')})">📁</button>
            </div>
            <img src="${s.art}">
            <h4>${escapeHtml(s.title)}</h4>
            <p>${escapeHtml(s.artist)}</p>
        `;
        c.onclick = () => playNow(s);
        recentDiv.appendChild(c);
    });
}

function renderPlaylists() {
    playlistsDiv.innerHTML = "";
    Object.keys(playlists).forEach(name => {
        const d = document.createElement("div");
        d.className = "playlist" + (currentPlaylist === name && currentPage === 'playlist' ? " active" : "");
d.innerHTML = `
    <span>
        <div class="emoji">📁</div>
        <div class="playlist-name">${escapeHtml(name)}</div>
    </span>
`;
        d.onclick = () => viewPlaylist(name);
        playlistsDiv.appendChild(d);
    });
    
    // Update home button state
    if (currentPage === 'home') {
        homeBtn.classList.add('active');
    } else {
        homeBtn.classList.remove('active');
    }
}

// Escape HTML
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Handle Enter key in playlist name input
document.getElementById("playlistName").addEventListener("keypress", (e) => {
    if (e.key === "Enter") createPlaylist();
});

    // === MIGRATION FROM OLD ITUNES VERSION ===
function migrateOldITunesPlaylists() {
    // Check if old data exists and we haven't migrated yet
    if (localStorage.getItem("miniPlaylists") && !localStorage.getItem("itunesMigrationDone")) {
// Custom migration modal
const migrationModal = document.createElement('div');
migrationModal.className = 'modal active'; // Reuse your existing modal styles
migrationModal.innerHTML = `
    <div class="modal-content" style="max-width: 480px;">
        <h3>Migrate Old Playlists?</h3>
        <p style="margin: 20px 0; line-height: 1.6; color: var(--muted);">
            We found playlists from an older version that used iTunes previews.<br><br>
            Would you like to convert them to YouTube videos now?<br>
            <strong>This may take 20–60 seconds depending on size.</strong>
        </p>
        <div class="modal-buttons">
            <button class="secondary" id="migCancel">No, thanks</button>
            <button class="primary" id="migStart">Yes, convert them</button>
        </div>
    </div>
`;

// Add a loading overlay (shown during conversion)
const loadingOverlay = document.createElement('div');
loadingOverlay.className = 'modal active';
loadingOverlay.innerHTML = `
    <div class="modal-content" style="text-align:center; padding:60px 40px;">
        <p style="font-size:18px; margin-bottom:20px;">Converting your old playlists...</p>
        <p style="color:var(--muted);">This may take a moment. Please wait.</p>
    </div>
`;
loadingOverlay.style.display = 'none'; // Hidden initially

// Append both to body
document.body.appendChild(migrationModal);
document.body.appendChild(loadingOverlay);

// Button handlers
document.getElementById('migCancel').onclick = () => {
    migrationModal.remove();
    loadingOverlay.remove();
    localStorage.setItem("itunesMigrationDone", "declined");
};

document.getElementById('migStart').onclick = () => {
    migrationModal.style.display = 'none';
    loadingOverlay.style.display = 'flex';

    // === NOW RUN THE ACTUAL MIGRATION ===
    try {
        const oldPlaylists = JSON.parse(localStorage.getItem("miniPlaylists") || "{}");
        let convertedCount = 0;
        const newPlaylists = { ...playlists };

        const migratePromises = Object.keys(oldPlaylists).map(async (playlistName) => {
            const oldPl = oldPlaylists[playlistName];
            if (!oldPl.songs || oldPl.songs.length === 0) return;

            newPlaylists[playlistName] = newPlaylists[playlistName] || [];

            for (const oldSong of oldPl.songs) {
                const query = `${oldSong.title} ${oldSong.artist?.name || ''}`.trim();
                try {
                    const res = await fetch(
                        `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&videoCategoryId=10&maxResults=1&q=${encodeURIComponent(query)}&key=${YT_KEY}`
                    );
                    const data = await res.json();
                    if (data.items && data.items.length > 0) {
                        const item = data.items[0];
                        const newSong = {
                            id: item.id.videoId,
                            title: escapeHtml(item.snippet.title),
                            artist: escapeHtml(item.snippet.channelTitle),
                            art: item.snippet.thumbnails.medium.url
                        };
                        newPlaylists[playlistName].push(newSong);
                        convertedCount++;
                    }
                } catch (e) {
                    console.warn(`Failed to convert: ${query}`, e);
                }
            }
        });

        Promise.all(migratePromises).then(() => {
            playlists = newPlaylists;
            saveData("playlists", playlists);

            localStorage.removeItem("miniPlaylists");
            localStorage.removeItem("recentlyPlayed");
            localStorage.removeItem("recentlyPlayedAlbums");
            localStorage.setItem("itunesMigrationDone", "true");

            // Remove modals
            migrationModal.remove();
            loadingOverlay.remove();

            // Success message (reuse your modal style)
            const successModal = document.createElement('div');
            successModal.className = 'modal active';
            successModal.innerHTML = `
                <div class="modal-content">
                    <h3 style="color:var(--accent);">Migration Complete! 🎉</h3>
                    <p style="margin:24px 0; line-height:1.6;">
                        ${convertedCount} songs were successfully converted into your playlists.<br><br>
                        You may want to review them for accuracy.
                    </p>
                    <div class="modal-buttons">
                        <button class="primary" onclick="this.closest('.modal').remove()">Got it!</button>
                    </div>
                </div>
            `;
            document.body.appendChild(successModal);

            renderPlaylists();
            if (currentPlaylist) renderPlaylistContent();
        });
    } catch (e) {
        console.error("Migration failed:", e);
        loadingOverlay.remove();
        migrationModal.remove();

        const errorModal = document.createElement('div');
        errorModal.className = 'modal active';
        errorModal.innerHTML = `
            <div class="modal-content">
                <h3>Oops!</h3>
                <p style="margin:24px 0;">Migration failed. Check the console for details.</p>
                <div class="modal-buttons">
                    <button class="primary" onclick="this.closest('.modal').remove()">Close</button>
                </div>
            </div>
        `;
        document.body.appendChild(errorModal);

        localStorage.setItem("itunesMigrationDone", "failed");
    }
};

        try {
            const oldPlaylists = JSON.parse(localStorage.getItem("miniPlaylists") || "{}");
            let convertedCount = 0;

            // We'll build new playlists in the current format
            const newPlaylists = { ...playlists }; // start with current ones

            const migratePromises = Object.keys(oldPlaylists).map(async (playlistName) => {
                const oldPl = oldPlaylists[playlistName];
                if (!oldPl.songs || oldPl.songs.length === 0) return;

                newPlaylists[playlistName] = newPlaylists[playlistName] || [];

                for (const oldSong of oldPl.songs) {
                    const query = `${oldSong.title} ${oldSong.artist?.name || ''}`.trim();
                    try {
                        const res = await fetch(
                            `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&videoCategoryId=10&maxResults=1&q=${encodeURIComponent(query)}&key=${YT_KEY}`
                        );
                        const data = await res.json();

                        if (data.items && data.items.length > 0) {
                            const item = data.items[0];
                            const newSong = {
                                id: item.id.videoId,
                                title: escapeHtml(item.snippet.title),
                                artist: escapeHtml(item.snippet.channelTitle),
                                art: item.snippet.thumbnails.medium.url
                            };
                            newPlaylists[playlistName].push(newSong);
                            convertedCount++;
                        }
                    } catch (e) {
                        console.warn(`Failed to convert: ${query}`, e);
                    }
                }
            });

            Promise.all(migratePromises).then(() => {
                // Save converted playlists
                playlists = newPlaylists;
                saveData("playlists", playlists);

                // Clean up old data optionally
                localStorage.removeItem("miniPlaylists");
                localStorage.removeItem("recentlyPlayed");
                localStorage.removeItem("recentlyPlayedAlbums");

                localStorage.setItem("itunesMigrationDone", "true");

                alert(`Migration complete!\n${convertedCount} songs were converted into your playlists.\n\nYou may want to review them for accuracy.`);
                
                renderPlaylists();
                if (currentPlaylist) renderPlaylistContent();
            });

        } catch (e) {
            console.error("Migration failed:", e);
            alert("Migration failed. Check console for details.");
            localStorage.setItem("itunesMigrationDone", "failed");
        }
    }
}

/* INIT */
renderQueue();
renderRecent();
renderPlaylists();

    migrateOldITunesPlaylists();

    // Show signup only after a short delay to ensure migration modal is done
setTimeout(showSignupIfNeeded, 1000);
// Background jazz player
const bgPlayer = document.getElementById('bgPlayer');
let isBgPlaying = true;

// Start background music on load (low volume)
window.addEventListener('load', () => {
    if (bgPlayer) {
        bgPlayer.contentWindow.postMessage('{"event":"command","func":"setVolume","args":[20]}', '*'); // 20% volume
    }
});

// Override playNow to stop background when user plays a song
const originalPlayNow = playNow;
playNow = function(song) {
    // Stop background jazz
    if (isBgPlaying && bgPlayer) {
        bgPlayer.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":[]}', '*');
        isBgPlaying = false;
    }
    
    // Play user's song normally
    originalPlayNow(song);
};

// Optional: Resume background if queue ends and nothing playing
function playNext() {
    const songs = currentPlaylist ? playlists[currentPlaylist].songs : queue;
    
    if (index < songs.length - 1) {
        index++;
        playNow(songs[index]);
    } else {
        // Queue ended — resume chill background
        if (bgPlayer && !isBgPlaying) {
            bgPlayer.contentWindow.postMessage('{"event":"command","func":"playVideo","args":[]}', '*');
            isBgPlaying = true;
        }
    }
}

    // === USER SIGN-UP SYSTEM (PURE JS) ===
async function showSignupIfNeeded() {
    // Check if user already signed up
    if (localStorage.getItem("tunesUser")) {
        return; // Already signed up → do nothing
    }

    // Helper to hash password securely
    async function hashPassword(password) {
        const encoder = new TextEncoder();
        const data = encoder.encode(password);
        const hash = await crypto.subtle.digest('SHA-256', data);
        return Array.from(new Uint8Array(hash))
            .map(b => b.toString(16).padStart(2, '0'))
            .join('');
    }

    // Create modal dynamically
    const modal = document.createElement('div');
    modal.className = 'modal active';
    modal.innerHTML = `
        <div class="modal-content">
            <h3>Welcome to TUNΞS</h3>
            <p style="margin:20px 0; color:var(--muted); font-size:14px; line-height:1.6;">
                Sign up once to keep your playlists safe across devices and browsers.
            </p>
            <input type="text" id="signupName" placeholder="Your name" autocomplete="name" style="margin-bottom:16px;">
            <input type="password" id="signupPassword" placeholder="Create a password" autocomplete="new-password" style="margin-bottom:16px;">
            <input type="date" id="signupDob" placeholder="Date of birth" style="margin-bottom:24px;">
            <div class="modal-buttons">
               
                <button class="primary" id="signupSubmit">Sign Up</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);

    // Focus first input
    const nameInput = document.getElementById('signupName');
    nameInput?.focus();

    // Handle signup
    document.getElementById('signupSubmit').onclick = async () => {
        const name = document.getElementById('signupName').value.trim();
        const password = document.getElementById('signupPassword').value;
        const dob = document.getElementById('signupDob').value;

        if (!name || !password || !dob) {
            alert("Please fill in all fields!");
            return;
        }

        // Validate age (must be at least 10)
        const birthDate = new Date(dob);
        const age = new Date().getFullYear() - birthDate.getFullYear();
        const monthDiff = new Date().getMonth() - birthDate.getMonth();
        const actualAge = monthDiff < 0 || (monthDiff === 0 && new Date().getDate() < birthDate.getDate()) ? age - 1 : age;

        if (actualAge < 10) {
            alert("You must be at least 10 years old to sign up.");
            return;
        }

        // Hash password and save user
        const hashed = await hashPassword(password);
        const userData = {
            name,
            dob,
            passwordHash: hashed,
            signedUpAt: new Date().toISOString()
        };

        localStorage.setItem("tunesUser", JSON.stringify(userData));
        modal.remove();

        // Optional: welcome toast
        const toast = document.createElement('div');
        toast.textContent = `Welcome, ${name}! 🎉`;
        toast.style.position = 'fixed';
        toast.style.bottom = '32px';
        toast.style.left = '50%';
        toast.style.transform = 'translateX(-50%)';
        toast.style.background = 'var(--accent)';
        toast.style.color = '#000';
        toast.style.padding = '16px 32px';
        toast.style.borderRadius = '50px';
        toast.style.fontWeight = '700';
        toast.style.zIndex = '9999';
        toast.style.boxShadow = '0 8px 32px rgba(0,0,0,0.5)';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    };

    // "Maybe later" just closes it (won't show again this session, but will next time page reloads)
    document.getElementById('signupLater').onclick = () => {
        modal.remove();
    };
}

// === CALL THIS AFTER THE MIGRATION POPUP (OR ON LOAD) ===
</script>

<script>
// === DYNAMIC BACKGROUND COLOR FROM THUMBNAIL (WITH CORS PROXY FIX) ===

// Smooth transition
document.querySelector('.bg-gradient').style.transition = 'background 1.5s ease';

// Free public CORS proxy (reliable as of 2026)
const CORS_PROXY = 'https://corsproxy.io/?';

function updateBackgroundFromThumbnail(thumbnailUrl) {
    if (!thumbnailUrl) return;

    // Proxy the URL to bypass CORS
    const proxiedUrl = CORS_PROXY + encodeURIComponent(thumbnailUrl);

    const img = new Image();
    img.crossOrigin = "anonymous"; // Still needed
    img.src = proxiedUrl;

    img.onload = () => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        if (!ctx) return;

        ctx.imageSmoothingEnabled = true;
        ctx.drawImage(img, 0, 0, 1, 1);

        const data = ctx.getImageData(0, 0, 1, 1).data;
        const r = data[0];
        const g = data[1];
        const b = data[2];

        // Darken a bit for subtle top glow
        const darkerFactor = 0.7;
        const topColor = `rgb(${Math.floor(r * darkerFactor)}, ${Math.floor(g * darkerFactor)}, ${Math.floor(b * darkerFactor)})`;

        document.querySelector('.bg-gradient').style.background =
            `linear-gradient(${topColor}, #000000)`;
    };

    img.onerror = () => {
        console.warn("Failed to load thumbnail (even via proxy)");
        // Optional: fall back to your static red
        // document.querySelector('.bg-gradient').style.background = 'linear-gradient(#FF0000, #000000)';
    };
}

// Hook into playNow
const originalPlayNow = playNow;
playNow = function(song) {
    originalPlayNow(song);
    if (song.art) {
        updateBackgroundFromThumbnail(song.art);
    }
};

// Initial load
if (recent.length > 0 && recent[0].art) {
    updateBackgroundFromThumbnail(recent[0].art);
}
</script>

<script>
// === PLAYLIST TITLE ACTIONS + CUSTOM MODALS FOR RENAME & DELETE ===

// Reusable Rename Modal
const renameModal = document.createElement('div');
renameModal.className = 'modal';
renameModal.innerHTML = `
    <div class="modal-content" style="max-width:400px; width:90%;">
        <h3>Rename Playlist</h3>
        <input id="renameInput" placeholder="New playlist name">
        <div class="modal-buttons">
            <button class="secondary" id="renameCancel">Cancel</button>
            <button class="primary" id="renameSave">Save</button>
        </div>
    </div>
`;
document.body.appendChild(renameModal);

// Reusable Delete Confirmation Modal
const deleteModal = document.createElement('div');
deleteModal.className = 'modal';
deleteModal.innerHTML = `
    <div class="modal-content" style="max-width:400px; width:90%;">
        <h3>Delete Playlist?</h3>
        <p style="margin:20px 0; color:var(--muted);">
            This will permanently delete "<span id="deletePlaylistName"></span>" and all its songs.
        </p>
        <div class="modal-buttons">
            <button class="secondary" id="deleteCancel">Cancel</button>
            <button class="primary" style="background:#ff4444; color:#fff;" id="deleteConfirm">Delete</button>
        </div>
    </div>
`;
document.body.appendChild(deleteModal);

// Rename modal logic
function openRenameModal(currentName) {
    document.getElementById('renameInput').value = currentName;
    document.getElementById('renameInput').focus();
    document.getElementById('renameInput').select();
    renameModal.classList.add('active');
}

document.getElementById('renameCancel').onclick = () => {
    renameModal.classList.remove('active');
};

document.getElementById('renameSave').onclick = () => {
    const newName = document.getElementById('renameInput').value.trim();
    if (!newName || newName === currentPlaylist) {
        renameModal.classList.remove('active');
        return;
    }
    if (playlists[newName]) {
        alert('A playlist with that name already exists!');
        return;
    }
    playlists[newName] = playlists[currentPlaylist];
    delete playlists[currentPlaylist];
    currentPlaylist = newName;
    saveData('playlists', playlists);
    playlistTitle.textContent = currentPlaylist;
    renderPlaylists();
    updatePlaylistTitleActions();
    renameModal.classList.remove('active');
};

// Delete modal logic
function openDeleteModal(playlistName) {
    document.getElementById('deletePlaylistName').textContent = playlistName;
    deleteModal.classList.add('active');
}

document.getElementById('deleteCancel').onclick = () => {
    deleteModal.classList.remove('active');
};

document.getElementById('deleteConfirm').onclick = () => {
    delete playlists[currentPlaylist];
    saveData('playlists', playlists);
    deleteModal.classList.remove('active');
    goHome();
};

// Close modals when clicking outside
renameModal.addEventListener('click', (e) => {
    if (e.target === renameModal) renameModal.classList.remove('active');
});
deleteModal.addEventListener('click', (e) => {
    if (e.target === deleteModal) deleteModal.classList.remove('active');
});

function updatePlaylistTitleActions() {
    if (currentPage !== 'playlist' || !currentPlaylist) return;

    const titleEl = document.getElementById('playlistTitle');
    if (!titleEl) return;

    const oldActions = titleEl.parentNode.querySelector('.playlist-title-actions');
    if (oldActions) oldActions.remove();

    const actions = document.createElement('div');
    actions.className = 'playlist-title-actions';

    // Rename button
    const renameBtn = document.createElement('button');
    renameBtn.innerHTML = '✎';
    renameBtn.title = 'Rename playlist';
    renameBtn.onclick = () => openRenameModal(currentPlaylist);

    // Delete button
    const deleteBtn = document.createElement('button');
    deleteBtn.innerHTML = '✕';
    deleteBtn.title = 'Delete playlist';
    deleteBtn.onclick = () => openDeleteModal(currentPlaylist);

    actions.appendChild(renameBtn);
    actions.appendChild(deleteBtn);
    titleEl.parentNode.insertBefore(actions, titleEl.nextSibling);
}

// Hooks
const originalViewPlaylist = viewPlaylist;
viewPlaylist = function(name) {
    originalViewPlaylist(name);
    updatePlaylistTitleActions();
};

const originalRenderPlaylistContent = renderPlaylistContent;
renderPlaylistContent = function() {
    originalRenderPlaylistContent();
    updatePlaylistTitleActions();
};

function cleanSidebarPlaylistActions() {
    document.querySelectorAll('.playlist-actions').forEach(el => el.remove());
}
const originalRenderPlaylists = renderPlaylists;
cleanSidebarPlaylistActions();
</script>

<script>
// === FINAL UNIFIED renderPlaylists (emoji + cleanup + home state) ===
let baseRenderPlaylists = renderPlaylists; // Save the original once

renderPlaylists = function() {
    baseRenderPlaylists(); // Run the original clearing logic

    playlistsDiv.innerHTML = ""; // Rebuild from scratch

    Object.keys(playlists).forEach(name => {
const pl = playlists[name];
const emoji = (pl && pl.emoji) ? pl.emoji : '📁';

        const d = document.createElement("div");
        d.className = "playlist" + (currentPlaylist === name && currentPage === 'playlist' ? " active" : "");
        d.innerHTML = `
            <span>
                <div class="emoji">${emoji}</div>
                <div class="playlist-name">${escapeHtml(name)}</div>
            </span>
        `;
        d.onclick = () => viewPlaylist(name);
        playlistsDiv.appendChild(d);
    });

    // Update home button active state
    if (currentPage === 'home') {
        homeBtn.classList.add('active');
    } else {
        homeBtn.classList.remove('active');
    }

    // Clean any stray old actions from sidebar (safety net)
    document.querySelectorAll('.playlist-actions').forEach(el => el.remove());
};

// Run once on load to apply to existing playlists
renderPlaylists();




// Weekly Compliance (TOS + Age Responsibility) – shows once per week max
function runWeeklyComplianceFlow() {
    const STORAGE_KEY = "tunesComplianceAck";
    const ONE_WEEK_MS = 7 * 24 * 60 * 60 * 1000;

    // Skip if recently acknowledged
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
        try {
            const data = JSON.parse(saved);
            if (Date.now() - data.timestamp < ONE_WEEK_MS) {
                return;
            }
        } catch {}
    }

    // Create full-screen modal
    const modal = document.createElement('div');
    modal.className = 'modal active';
    modal.style.zIndex = '10001'; // above everything

    modal.innerHTML = `
        <div class="modal-content" style="max-width:520px; width:90%; padding:40px 32px;">
            <h3>Welcome to TUNΞS – Quick Rules</h3>
            
            <div id="step1" style="display:block;">
                <p style="margin:20px 0; line-height:1.6; color:var(--muted);">
                    This app is for <strong>personal use during free time only</strong>.<br><br>
                    <strong>Do NOT</strong> use it during class, lessons, or assessments.<br>
                    Accounts are for students <strong>12 years and older</strong>.<br><br>
                    Misuse may result in access being removed to protect the app for everyone.
                </p>
                <div id="tosScroll" style="
                    height: 220px; overflow-y:auto; padding:16px; margin:24px 0;
                    background:rgba(255,255,255,0.06); border-radius:12px; border:1px solid var(--border);
                    font-size:13px; line-height:1.6; color:#ccc;
                ">
                    <strong>Terms Summary – please scroll to read fully:</strong><br><br>
                    1. Personal, non-commercial use only.<br>
                    2. No use during instructional time or exams.<br>
                    3. Minimum age 12 – younger users may have access restricted.<br>
                    4. Respect school rules and teacher instructions.<br>
                    5. Feedback welcome, but no guarantees of features or uptime.<br>
                    6. We may suspend access for repeated misuse.<br><br>
                    By continuing, you confirm you understand and agree to these points.
                </div>
                <label style="display:flex; align-items:center; gap:12px; margin:20px 0; font-size:14px;">
                    <input type="checkbox" id="tosAgree" disabled> I have read and agree
                </label>
                <div class="modal-buttons">
                    <button class="primary" id="step1Next" disabled>Continue</button>
                </div>
            </div>

            <div id="step2" style="display:none;">
                <h4>One Last Check</h4>
                <p style="margin:24px 0; line-height:1.6; color:var(--muted);">
                    This music player is intended for <strong>older students (12+)</strong>.<br><br>
                    Using it in class disrupts learning for you and others.<br>
                    Please only open TUNΞS during breaks, lunch, or after school.
                </p>
                <div class="modal-buttons" style="margin-top:32px;">
                    <button class="primary" id="finalAcknowledge" disabled>
                        I am 12+ and will follow the rules
                    </button>
                </div>
            </div>
        </div>
    `;

    document.body.appendChild(modal);

    // Step 1 logic: scroll to enable checkbox
    const scrollBox = modal.querySelector('#tosScroll');
    const checkbox = modal.querySelector('#tosAgree');
    const nextBtn = modal.querySelector('#step1Next');

    scrollBox.addEventListener('scroll', () => {
        if (scrollBox.scrollTop + scrollBox.clientHeight >= scrollBox.scrollHeight - 10) {
            checkbox.disabled = false;
        }
    });

    checkbox.addEventListener('change', () => {
        nextBtn.disabled = !checkbox.checked;
    });

    nextBtn.onclick = () => {
        modal.querySelector('#step1').style.display = 'none';
        modal.querySelector('#step2').style.display = 'block';
    };

    // Step 2: anti-skip delay (forces reading)
    setTimeout(() => {
        modal.querySelector('#finalAcknowledge').disabled = false;
    }, 4000);

    modal.querySelector('#finalAcknowledge').onclick = () => {
        localStorage.setItem(STORAGE_KEY, JSON.stringify({ timestamp: Date.now() }));
        modal.remove();
    };
}

    // Teacher selection + age lock – runs once unless locked
function runTeacherSelectionAndAgeLock() {
    const TEACHER_KEY = "tunesTeacher";
    const LOCK_KEY = "tunesLock";
    const MIN_AGE = 12;
    const RESTRICTED_TEACHERS = ["Gibbons", "Kristoff","Dolat", "Hawkridge", "Chappy.", "StPierre"];
    const OVERRIDE_KEYS = ["TUNES-ADMIN-2026", "TEMP-ACCESS-2026"];

    // Already selected & not locked → skip
    if (localStorage.getItem(TEACHER_KEY) && !localStorage.getItem(LOCK_KEY)) {
        return;
    }

    // Check current lock status
    if (localStorage.getItem(LOCK_KEY)) {
        showLockedScreen();
        return;
    }

    // Show teacher picker
    const modal = document.createElement('div');
    modal.className = 'modal active';
    modal.style.zIndex = '10002';

    modal.innerHTML = `
        <div class="modal-content" style="max-width:420px; padding:40px 32px;">
            <h3>One Quick Question</h3>
            <p style="margin:20px 0; color:var(--muted); line-height:1.6;">
                To keep TUNΞS working smoothly at school,<br>please select your teacher.
            </p>
            <select id="teacherSelect" style="width:100%; padding:14px; border-radius:10px; background:var(--soft); color:white; border:1px solid var(--border); margin:24px 0;">
                <option value="">Select your teacher</option>
                <option>Gibbons</option>
                <option>Kristoff</option>
                <option>Dolat</option>
                <option>Hawkridge</option>
                <option>Chappy.</option>
                <option>StPierre</option>
                <option>Roczniak</option>
                <option>McClure</option>
                <option>Loughlin</option>
                <option>Nichols</option>
                <option>Ruppert</option>
                <option>walker</option>
                <option>Other</option>
            </select>
            <div class="modal-buttons">
                <button class="primary" id="teacherSubmit" disabled>Continue</button>
            </div>
        </div>
    `;

    document.body.appendChild(modal);

    const select = modal.querySelector('#teacherSelect');
    const btn = modal.querySelector('#teacherSubmit');

    select.onchange = () => { btn.disabled = !select.value; };

    btn.onclick = () => {
        const teacher = select.value.trim();
        localStorage.setItem(TEACHER_KEY, teacher);

        // Get age from signup
        let age = null;
        try {
            const user = JSON.parse(localStorage.getItem("tunesUser") || "{}");
            if (user.dob) {
                const birth = new Date(user.dob);
                const now = new Date();
                age = now.getFullYear() - birth.getFullYear();
                if (now.getMonth() < birth.getMonth() || 
                    (now.getMonth() === birth.getMonth() && now.getDate() < birth.getDate())) {
                    age--;
                }
            }
        } catch {}

        // Apply lock only if restricted teacher AND under age
        if (RESTRICTED_TEACHERS.includes(teacher) && (age === null || age < MIN_AGE)) {
            localStorage.setItem(LOCK_KEY, JSON.stringify({ lockedAt: Date.now() }));
            modal.remove();
            showLockedScreen();
        } else {
            modal.remove();
        }
    };
}

function showLockedScreen() {
    const modal = document.createElement('div');
    modal.className = 'modal active';
    modal.style.zIndex = '10003';

    modal.innerHTML = `
        <div class="modal-content" style="max-width:460px; padding:40px 32px; text-align:center;">
            <h3>Access Paused</h3>
            <p style="margin:24px 0; color:var(--muted); line-height:1.6;">
                Music playback is currently limited.<br><br>
                It will unlock automatically if age requirements are met,<br>
                or a dev. can provide an access key.
            </p>
            <input id="unlockKey" placeholder="Enter access key" style="width:100%; padding:14px; margin:20px 0; border-radius:10px; background:var(--soft); border:1px solid var(--border); color:white;">
            <div class="modal-buttons">
                <button class="primary" id="unlockBtn">Unlock</button>
            </div>
        </div>
    `;

    document.body.appendChild(modal);

    modal.querySelector('#unlockBtn').onclick = () => {
        const key = modal.querySelector('#unlockKey').value.trim();
        if (OVERRIDE_KEYS.includes(key)) {
            localStorage.removeItem("tunesLock");
            modal.remove();
            alert("Access unlocked! Enjoy TUNΞS 🔥");
        } else {
            alert("Invalid key – try again.");
        }
    };
}
    // ─────────────── ONBOARDING LAUNCH ───────────────
window.addEventListener('load', () => {
    setTimeout(() => {
        // Always try compliance flow (weekly check inside function)
        runWeeklyComplianceFlow();
        
        // Then teacher/age lock (once or when needed)
        setTimeout(runTeacherSelectionAndAgeLock, 800);
    }, 1200);
});

</script>
    
</body>
</html>
